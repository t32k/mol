<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <title>ブロックチェーンとマイニング - MOL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="twitter:title" content="ブロックチェーンとマイニング - MOL" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@t32k" />
  
  <meta name="description" content="この記事は、ブロックチェーン Advent Calendar 2017の3日目です、たぶん、知らんけど。" />
  <meta name="twitter:description" content="この記事は、ブロックチェーン Advent Calendar 2017の3日目です、たぶん、知らんけど。" />
  
  <meta property="og:type" content="article" />
  <meta property="og:site_name" content="MOL" />
  
  <meta property="og:image" content="https://t32k.me/mol/images/people/me.jpg" />
  <meta name="twitter:image" content="https://t32k.me/mol/images/people/me.jpg" />
  
  <meta property="fb:app_id" content="212646065416408" />
  <link rel="canonical" href="https://t32k.me/mol/log/how-bitcoin-mining-works/" />
  <link rel="alternate" href="/mol/index.xml" type="application/rss+xml" title="MOL" />
  <link rel="preconnect" href="https://fonts.gstatic.com" />
  <link rel="preload" as="style"
    href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap"
    media="print" onload="this.media='all'" />

  <link rel="stylesheet" href="/mol/css/app.css?20210421" />
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-2317436-26"></script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
    data-ad-client="ca-pub-1326877318485833"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-2317436-26');
  </script>
</head>

<body>
  <svg class="u-dn">
	<symbol id="post-fb" viewBox="0 0 24 24">
		<path d="M21.087 0H2.913C1.303 0 0 1.304 0 2.913v18.174C0 22.697 1.304 24 2.913 24h18.174C22.697 24 24 22.696 24 21.087V2.913C24 1.303 22.696 0 21.087 0zm-5.14 6.446h-1.864c-.658 0-.795.27-.795.95V9.04h2.658l-.256 2.887h-2.402v8.623H9.845v-8.587h-1.79V9.04h1.79V6.738c0-2.16 1.155-3.288 3.717-3.288h2.384v2.996z"
		 fill="#334F8D" fill-rule="evenodd" />
	</symbol>
	<symbol id="post-tw" viewBox="0 0 24 24">
		<path d="M21.087 0H2.913C1.303 0 0 1.304 0 2.913v18.174C0 22.697 1.304 24 2.913 24h18.174C22.697 24 24 22.696 24 21.087V2.913C24 1.303 22.696 0 21.087 0zm-2.333 9.153c.207 4.605-3.228 9.74-9.307 9.74-1.85 0-3.57-.542-5.02-1.47 1.738.204 3.472-.278 4.848-1.357-1.432-.027-2.642-.973-3.058-2.274.513.098 1.018.07 1.478-.056C6.12 13.42 5.035 12 5.07 10.484c.44.245.945.393 1.482.41-1.458-.975-1.87-2.9-1.013-4.372 1.614 1.98 4.027 3.285 6.748 3.42-.478-2.047 1.076-4.02 3.19-4.02.94 0 1.792.398 2.39 1.035.745-.147 1.446-.42 2.08-.795-.246.765-.765 1.406-1.44 1.812.66-.08 1.292-.255 1.88-.516-.44.657-.994 1.233-1.634 1.695z"
		 fill="#55ACEE" fill-rule="evenodd" />
	</symbol>
	<symbol id="post-gp" viewBox="0 0 24 24">
		<path d="M9.267 10.757c-1.3-.04-2.538-1.232-2.762-2.94-.225-1.71.648-3.018 1.95-2.98 1.3.04 2.413 1.442 2.637 3.15.225 1.71-.524 2.81-1.825 2.77zM9 14.254c-1.938-.02-3.58 1.225-3.58 2.67 0 1.474 1.4 2.702 3.338 2.702 2.478 0 3.676-1.152 3.676-2.627 0-1.406-1.283-2.746-3.434-2.746zm15-11.34v18.173C24 22.697 22.696 24 21.087 24H2.913C1.303 24 0 22.696 0 21.087V2.913C0 1.303 1.304 0 2.913 0h18.174C22.697 0 24 1.304 24 2.913zm-9.897 13.914c0-1.36-.508-2.25-2.045-3.402-1.56-1.138-1.94-1.78-.452-2.93.838-.65 1.426-1.514 1.426-2.58 0-1.164-.475-2.22-1.37-2.73h1.268l1.08-1.133H9.18c-3.013 0-4.49 1.806-4.49 3.793 0 2.03 1.392 3.63 4.113 3.63-.422.852-.253 1.638.437 2.2-4.646 0-5.64 2.04-5.64 3.61 0 2.034 2.34 3.244 5.144 3.244 3.835 0 5.36-2.032 5.36-3.702zM20.4 6.502h-2.227V4.275H17.06v2.227H14.83v1.114h2.227v2.227h1.113V7.616H20.4V6.502z"
		 fill="#DD4B39" fill-rule="evenodd" />
	</symbol>
	<symbol id="post-hb" viewBox="0 0 24 24">
		<path d="M0 21.12C0 22.71 1.29 24 2.88 24h18.24c1.59 0 2.88-1.29 2.88-2.88V2.88C24 1.29 22.71 0 21.12 0H2.88C1.29 0 0 1.29 0 2.88v18.24zm16.765-6.65c-.78 0-1.412.632-1.412 1.412 0 .78.632 1.412 1.412 1.412.78 0 1.412-.632 1.412-1.412 0-.78-.633-1.41-1.412-1.41zM15.53 6.707H18v7.06h-2.47v-7.06zm-2.288 5.668c-.418-.467-1-.73-1.745-.787.663-.18 1.145-.445 1.45-.798.303-.35.454-.823.454-1.42 0-.47-.102-.888-.302-1.248-.205-.36-.5-.645-.886-.86-.338-.186-.74-.317-1.21-.395-.47-.075-1.295-.113-2.478-.113H5.647v10.492H8.61c1.192 0 2.05-.042 2.575-.122.525-.082.965-.22 1.32-.41.442-.234.778-.565 1.013-.99.236-.426.353-.918.353-1.48 0-.78-.208-1.404-.628-1.87zM8.302 9.08h.615c.71 0 1.187.08 1.433.24.243.16.367.437.367.83 0 .38-.132.647-.393.804-.264.153-.745.23-1.45.23h-.57V9.08zm2.437 6.017c-.28.17-.762.255-1.437.255h-1V13.06h1.043c.694 0 1.173.087 1.428.262.26.174.387.482.387.924 0 .396-.14.68-.42.85z"
		 fill="#00A4DE" fill-rule="evenodd" />
	</symbol>
	<symbol id="shape-github" viewBox="0 0 24 24">
		<path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm2.218 18.616c-.354.069-.468-.149-.468-.336v-1.921c0-.653-.229-1.079-.481-1.296 1.56-.173 3.198-.765 3.198-3.454 0-.765-.273-1.389-.721-1.879.072-.177.312-.889-.069-1.853 0 0-.587-.188-1.923.717-.561-.154-1.159-.231-1.754-.234-.595.003-1.193.08-1.753.235-1.337-.905-1.925-.717-1.925-.717-.379.964-.14 1.676-.067 1.852-.448.49-.722 1.114-.722 1.879 0 2.682 1.634 3.282 3.189 3.459-.2.175-.381.483-.444.936-.4.179-1.413.488-2.037-.582 0 0-.37-.672-1.073-.722 0 0-.683-.009-.048.426 0 0 .46.215.777 1.024 0 0 .405 1.25 2.353.826v1.303c0 .185-.113.402-.462.337-2.782-.925-4.788-3.549-4.788-6.641 0-3.867 3.135-7 7-7s7 3.133 7 7c0 3.091-2.003 5.715-4.782 6.641z" />
	</symbol>
	<symbol id="shape-dribbble" viewBox="0 0 24 24">
		<path d="M11.455 9.985c-1.419.417-3.11.632-5.067.646.405-1.654 1.518-3.03 3.003-3.784.777 1.016 1.464 2.063 2.064 3.138zm.965 1.93c-.124-.28-.254-.559-.391-.835-1.622.51-3.561.769-5.804.772l-.008.148c0 1.404.504 2.692 1.34 3.695 1.266-1.901 2.891-3.164 4.863-3.78zm-3.97 4.641c1.569 1.225 3.671 1.589 5.624.836-.252-1.488-.65-2.94-1.19-4.352-1.819.542-3.285 1.714-4.434 3.516zm7.075-9.13c-.977-.754-2.197-1.209-3.525-1.209-.49 0-.964.068-1.418.184.764 1.028 1.441 2.086 2.035 3.172 1.236-.524 2.204-1.24 2.908-2.147zm8.475 4.574c0 6.627-5.373 12-12 12s-12-5.373-12-12 5.373-12 12-12 12 5.373 12 12zm-5 0c0-3.866-3.135-7-7-7s-7 3.134-7 7 3.135 7 7 7 7-3.134 7-7zm-5.824-1.349c.157.324.305.651.447.98 1.26-.217 2.641-.204 4.143.042-.073-1.292-.566-2.474-1.354-3.403-.807 1.005-1.89 1.798-3.236 2.381zm.914 2.132c.489 1.309.865 2.651 1.119 4.023 1.312-.88 2.241-2.284 2.497-3.909-1.317-.228-2.522-.268-3.616-.114z" />
	</symbol>
	<symbol id="shape-rss" viewBox="0 0 24 24">
		<path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-3.374 17c-.897 0-1.626-.727-1.626-1.624s.729-1.624 1.626-1.624 1.626.727 1.626 1.624-.729 1.624-1.626 1.624zm3.885 0c-.03-3.022-2.485-5.474-5.511-5.504v-2.406c4.361.03 7.889 3.555 7.92 7.91h-2.409zm4.081 0c-.016-5.297-4.303-9.571-9.592-9.594v-2.406c6.623.023 11.985 5.384 12 12h-2.408z" />
	</symbol>
	<symbol id="shape-linkedin" viewBox="0 0 24 24">
		<path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm-2 16h-2v-6h2v6zm-1-6.891c-.607 0-1.1-.496-1.1-1.109 0-.612.492-1.109 1.1-1.109s1.1.497 1.1 1.109c0 .613-.493 1.109-1.1 1.109zm8 6.891h-1.998v-2.861c0-1.881-2.002-1.722-2.002 0v2.861h-2v-6h2v1.093c.872-1.616 4-1.736 4 1.548v3.359z" />
	</symbol>
</svg>
</body>

</html>
<header class="site-header">
  <div class="container">
    <nav class="u-cf">
      <a href="/mol/">MOL</a>
      <a href="/">About</a>
      <a href="/mol/log/">Logs</a>
    </nav>
  </div>
</header>



<div class="container">
  <article role="main" class="post">
    <header class="post-header">
      <p class="u-mute u-mbn"><time
          datetime='2017-12-03T00:00:00Z'>December 3, 2017</time></p>
      <h1 class="post-h1">ブロックチェーンとマイニング</h1>
       <h3 class="u-mute u-mtn">How Bitcoin Mining Works</h3>
    </header>
    <section>
      

<p>この記事は、<a href="//qiita.com/advent-calendar/2017/blockchain">ブロックチェーン Advent Calendar 2017</a>の 3 日目です、たぶん、知らんけど。なんだか<a href="https://medium.com/@sucoshi/%E3%83%96%E3%83%AD%E3%83%83%E3%82%AF%E3%83%81%E3%82%A7%E3%83%BC%E3%83%B3%E3%81%8C%E6%94%B9%E3%81%96%E3%82%93%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E4%BB%95%E7%B5%84%E3%81%BF-1b2435af607">前の人</a>と記事の内容が被ってる気もするが、がんばってやっていき。</p>

<p><img src="/mol/images/2017/1206-01.png" width="300" alt=""></p>

<h2 id="proof-of-work">Proof of Work</h2>

<p>みんな、マイニングしてるか！僕はイーサリアムだけど<a href="/mol/log/mining-rig-v2/">ちょっとやってた</a>。ブロックチェーンはその名の通り、ある程度のトランザクション情報をまとめたブロックをチェーンのように繋いでいく分散型台帳システム。</p>

<p>そのブロックを繋げる際に、ビットコインであれば proof of work（PoW）というコンセンサス（合意）アルゴリズムを採用しているので、莫大な計算量（Work）を用いて、新たに台帳に記載されるブロックが正しいかどうか承認する作業（Proof）が行われる。</p>

<p><img src="/mol/images/2017/1206-00.png" width="200" alt=""></p>

<p>この作業を一番早く正しく終えた人が、その報酬として一定量のビットコイン(2017 年現在：12.5BTC)とブロックに含まれるすべてのトランザクション手数料を貰えることができるので、この作業を金の採掘に例えてマイニングと言っている。</p>

<p>なぜ、このような事をするのかというと、前述の通りブロックチェーンは<strong>分散</strong>台帳なので、誰でも手元にダウンロードすることができ、もし悪意のある誰かが自分のアドレスに 100BTC 振り込むといった偽の情報をブロックに入れたとしたら大変。しかし、そのような偽のチェーンはマイニングするのは、微々たる計算量しかもたない、その人しかおらず、チェーンを続けることはできないので、正当性のあるチェーンだけが生き残る算段。</p>

<p>中央集権的なデータベースであれば、このようなマイニングをする必要はないが、特定の誰か（個人・企業）を信じなければならいし、その人が善人であったとしても、また他の誰かからハッキングされるかもしれない。それに比べて、ブロックチェーンであれば誰も信頼する必要がないし、
マイニング報酬というインセンティブで多くのマイナーが計算量を提供しシステムを維持しているので改ざんは極めて困難だ。</p>

<p>と、こんなことぜんぜん分からなくても、僕自身イーサリアムでマイニングしてたので問題はないんだけど、もうちょっと技術的に理解したいと思い、積読してあったマスタリングビットコインを読んでみたよ。</p>

<div class="__media"><a href="https://www.amazon.co.jp/dp/4757103670/?tag=warikiru-22" target="_blank" rel="noopener">
<img src="https://images-na.ssl-images-amazon.com/images/I/51NjHWZBJJL._SX393_BO1,204,203,200_.jpg" alt="" class="__media__image">
<div class="__media__body">
    <div>Mastering Bitcoin<br>ビットコインとブロックチェーン:暗号通貨を支える技術</div>
    <div class="__media__text">アンドレアス・M・アントノプロス</div>
    <div>Amazon.co.jpで詳細を見る</div>
</div>
</a></div>

<h2 id="cryptographic-hash-functions">Cryptographic Hash Functions</h2>

<p>マイニングで計算、計算って言ってるけど、実際に何してるのってことで、ハッシュ関数をいっぱい実行している。</p>

<blockquote>
<p>ハッシュ関数 (ハッシュかんすう、英: hash function) あるいは要約関数とは、あるデータが与えられた場合にそのデータを代表する数値を得る操作、または、その様な数値を得るための関数のこと。ハッシュ関数から得られた数値のことを要約値やハッシュ値または単にハッシュという。</p>
</blockquote>

<p><a href="//ja.wikipedia.org/wiki/%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E9%96%A2%E6%95%B0">Wikipedia</a>はかくゆう。</p>

<p>実際に動かしたほうが早いので、Node.js の<code>crypto</code>モジュールを使って、<code>t32k</code>という文字列をハッシュ化してみる。</p>

<pre><code>const crypto = require('crypto');
const shas256 = crypto.createHash('sha256');
shas256.update('t32k');
const hash = shas256.digest('hex');
console.log(hash);

&gt;&gt; 69511c70d742fda9555512fea208338e1c49cb3e9ab0a1e3246e262952517806
</code></pre>

<p>ビットコインでは SHA-256（Secure Hash Algorithm）を用いて、ハッシュ化されるので、<code>t32k</code>の元データが 64 文字の 16 進数文字列に変換された。これは何回実行したところで<code>t32k</code>の文字列は<code>69511c7...</code>の同じハッシュ値である。</p>

<p>また変換する文字列<code>t32k</code>から、<code>t33k</code>に変更してみると以下のようハッシュ値ができあがる。</p>

<pre><code>&gt;&gt; 719e66ad70e70e39b9627ec4fd5dfb8a7015c3be5ac35f48c4d3a60b8aeed4f9
</code></pre>

<p>たった一文字だけ違うのに、全く異なるハッシュ値ができあがるので、生成されたハッシュ値から元データを推測するのは困難であり、暗号数理的性質をもつ。</p>

<p>では、ビットコインのマイニングでハッシュ関数はどのように使われてるか見てみる前に、ここではマイニングをチョー簡略化した例をやってみよう。</p>

<p><img src="/mol/images/2017/1206-07.png" width="200" alt=""></p>

<p><code>t32k</code>の文字列のお尻に数字を付けてインプットとし、出来上がるハッシュ値の先頭が 0 で始まる数字を見つけることにする。</p>

<p>試しに 0~9 の数値で試してみることにする。</p>

<pre><code>const crypto = require('crypto');

let n = 0;

while (n &lt; 10) {
	const shas256 = crypto.createHash('sha256');
	const input = 't32k' + n;
	shas256.update(input);
	const hash = shas256.digest('hex');
	console.log(`HASH-${n}`, hash);
	n++;
}
</code></pre>

<pre><code>HASH-0 46a26cdf4f1f6825d191e66f2c2c00cea62993909b559ddc9682a102bf5c44ed
HASH-1 ea179996e7010c1cf52a6e291dc8c052fc8e9bad41f5007b2a403bfa8b758ad1
HASH-2 39e402b62052d67cd97d469a792b2147cfde04bea6ed1826a88d1fffff9fccd9
HASH-3 c5015b15ae1f3f7b48bd0a21b93efa36ab5909078e8d0ff6104fc66e8c8281f7
HASH-4 033e3bf0ca03bd4ae08ab1578fce35ae1f1edeeb753cd0ebe1813012e8522d45
HASH-5 f2a87d02c46abbbba83a2d04c600faf4df5a04d438753eb86e92d9f3e4c0899a
HASH-6 8a91c41c4fedacba77199887745996b5064e678dbdee63870253e8cb3e653ddd
HASH-7 ae040ca8afcb5f6ecc5ab21471c1d1064c1612f20b6ab83098f59a4d508cdcc9
HASH-8 7629b92d6e54b01065e17d131215bfae92f1a772e47fe7faf2412d179bcb8e00
HASH-9 1e04407ced654405978eacd00f66537b931f6e5d5c750e7d222b3b7d0b099a5d
</code></pre>

<p>運良く、5 回目で<code>033e3bf0ca...</code>というハッシュ値を見つけることができた。ということで与えられた課題に対する答え（数値）は<code>4</code>になる。ビットコインのマイニングも掛け合わせる文字列はもっと多いが基本的にやってることといえば、この数値、ナンス（nonce：暗号通信で用いられる使い捨てのランダムな値）を探すことにほかならない。</p>

<p><a href="https://blockchain.info/ja/block/000000000000000000b41bd9306ac5f21340f8e704e861695ca0d7274257b852"><img src="/mol/images/2017/1206-03.png" alt="" /></a></p>

<p>ただ、求められる難易度はこのサンプルケースの場合と桁違いに難しい。2017 年 12 月現在のビットコインのブロックハッシュ値は先頭から 0 が 18 個続くようなとても小さい値になっている。0 が 1 個だけじゃ到底だめだし、16 個や 17 個のような大きな数値はハッシュ値としては認められないのである。</p>

<p><img src="/mol/images/2017/1206-02.png" width="200" alt=""></p>

<p>サイコロの例に使えば、２つのサイコロ振り、出た目の総和が 12 より小さくしろ！と言われれば、両方 6 が出ない限りほぼ成功できるが、総和が 5 の場合だったらどうだろう。とたんに難しくなる。このように値が小さければ小さいほど難易度は格段に難しくなるので、ビットコインマイニングの場合は、サイコロを何千兆回と振らなければならない（ナンスを探さなければならない）。</p>

<p><img src="/mol/images/2017/1206-04.png" alt="" /></p>

<h2 id="hash-chaining">Hash Chaining</h2>

<table>
<thead>
<tr>
<th>フィールド</th>
<th>サイズ</th>
<th>説明</th>
</tr>
</thead>

<tbody>
<tr>
<td>Version</td>
<td>4 バイト</td>
<td>ソフトウェア・プロトコルバージョン番号</td>
</tr>

<tr>
<td>Previous Block Hash</td>
<td>32 バイト</td>
<td>1 つ前のブロックのハッシュ</td>
</tr>

<tr>
<td>Merkle Root</td>
<td>32 バイト</td>
<td>ブロック内すべての TX に関するマークルツリーの root ハッシュ</td>
</tr>

<tr>
<td>Timestamp</td>
<td>4 バイト</td>
<td>ブロックのおおよその生成時刻（Unix 秒）</td>
</tr>

<tr>
<td>Difficulty Target</td>
<td>4 バイト</td>
<td>ブロック生成時の difficulty</td>
</tr>

<tr>
<td>Nonce</td>
<td>4 バイト</td>
<td>！！！コイツを求める！！！</td>
</tr>
</tbody>
</table>

<p>ブロックチェーンはある程度のトランザクション情報がまとまったブロックがチェーンでつながっていると述べたが、各ブロックは上記のヘッダー情報を持っている。フィールドに <code>Previous Block Hash</code>が入ってるので、求めるハッシュは前のブロックに影響を受ける。</p>

<p>このブロックヘッダを SHA-256 で 2 回ハッシュした値が、Difficulty Target よりも小さな値（先頭から 0 が何十個も続くようなハッシュ値）であれば、ブロックをチェーンにつなげることができる。</p>

<pre><code>{
	&quot;hash&quot;: &quot;0000000000000000001b09f6b279c46eca668d8403f7667c8420f6af0e091fff&quot;,
	&quot;confirmations&quot;: 3,
	&quot;strippedsize&quot;: 983850,
	&quot;size&quot;: 1046572,
	&quot;weight&quot;: 3998122,
	&quot;height&quot;: 497327,
	&quot;version&quot;: 536870912,
	&quot;versionHex&quot;: &quot;20000000&quot;,
	&quot;merkleroot&quot;: &quot;137e5fede907ce0702b5b6fa200887decbeecdd4cfdad924fb253b475ed31c77&quot;,
	&quot;tx&quot;: [
		&quot;f3810f2f169c43741cf43796d675efe170875af58bfd7577b9da0a1adc84b782&quot;,
		........
		&quot;9590f9fecc80b62022ba21c9e3c2eef391d3dfebc42837f18a1a4117bcd49244&quot;
	],
	&quot;time&quot;: 1512287387,
	&quot;mediantime&quot;: 1512284779,
	&quot;nonce&quot;: 3429537634,
	&quot;bits&quot;: &quot;1800d0f6&quot;,
	&quot;difficulty&quot;: 1347001430558.57,
	&quot;chainwork&quot;: &quot;000000000000000000000000000000000000000000bf0b7d29b7b36413c84f60&quot;,
	&quot;previousblockhash&quot;: &quot;000000000000000000883f5ccff5b7140e4d10bf85f6aed570b8bc6f62330542&quot;,
	&quot;nextblockhash&quot;: &quot;000000000000000000605538204e452c5cfdd9937a3ffe157ff2d91f692ba313&quot;
}
</code></pre>

<p><a href="https://blockchain.info/ja/block/0000000000000000001b09f6b279c46eca668d8403f7667c8420f6af0e091fff">ブロック#497327</a>のブロック情報の例（Transaction は一部省略）</p>

<p>なお、この Difficulty は 2016 ブロック生成（約 2 週間）されるたびに、直近の 2016 ブロック生成にかかった時間を元に調整される。</p>

<h2 id="merkle-trees">Merkle Trees</h2>

<p>ブロックのヘッダーにひとつ解せさないものがある。Merkle Root とはなんだ？ということで、マークルツリーに興味を持った。マークルツリーというのは、公開鍵暗号の開発者の一人であるラルフ・マークルによって発明された、データを要約したハッシュツリーのことだ。</p>

<p><img src="/mol/images/2017/1206-06.png" alt="" /></p>

<p>ビットコインではブロック内のトランザクション全体の要約のために使われている。ブロック内のトランザクションデータはハッシュ関数にかけられ、さらに隣り合うハッシュ値をあわせてハッシュ関数にかけられる。このようにかけあわせていくことで、何百というトランザクションはひとつのハッシュで表すことができる。これがマークルルートのハッシュだ。</p>

<p>ちなみに、先頭のトランザクションはコインベーストランザクションと呼ばれるものである。通常のトランザクションは必ずインプット元のトランザクションデータがあるが、コインベースにはない。それはマイニングで得た報酬を得るマイナーのアドレスが含まれたトランザクションであるため、無からビットコインが生まれる瞬間である。</p>

<p>さらちなみに、ハッシュレートの向上により、4 バイトのナンスでは一瞬で探索できるようになってきたので、コインベーストランザクションの一部をエキストラナンス 8 バイトも使うことで毎秒 2 の 96 乗通り試すことができる。</p>

<h2 id="51-attack">51% Attack</h2>

<p><a href="https://blockchain.info/ja/charts/hash-rate?timespan=all"><img src="/mol/images/2017/1206-09.png" alt="" /></a>
Hash Rate の推移</p>

<p>マイニングには莫大な計算量が必要だと理解できたが、現在のビットコインマイニングは個人がどうこうレベルではない。CPU や GPU よりも多くの計算ができる ASIC（特定用途向け集積回路）を何千台と用意した事業者が幅をきかせている。だからといって、個人はマイニングに参加できないかというとそうでもない。</p>

<p>マイニングプールというマイナー同士が協力しあって計算リソースを提供し、その貢献度によってマイニングで得た報酬を分配されるしくみがある。マイニングプールに参加しているマイナーが、もし実際にナンスを見つけたとしても、その人には 12.5BTC 全部はもらえない、そのプールに貢献した計算リソース分しかもらえないのである。まぁそんなことは一般個人には確率的にほぼない
に等しいので、マイニングプールで少量ながらも稼ぐのが現実的である。</p>

<p>そういうわけで、そんな人のために世界にはいくつかのマイニングプールがある。</p>

<p><a href="https://blockchain.info/ja/pools"><img src="/mol/images/2017/1206-05.png" alt="" /></a></p>

<p>上記グラフは 2017 年 12 月のマイニングシェアを表したものだが、上位はほぼ中国勢に抑えられている。各プール業者の割合は 10%前後だが、もしこれらの業者が 5 つ、6 つ結託して、マイニングシェアの 51%以上を取ったとしたらどうなるだろう。多くの個人マイナーが参加しているマイニングプールとはいえ、それはマネージドされた環境であり、我々の計算リソースはプールの管理者に委ねられているので、悪意のあるデータに改ざんしたチェーンを作成、維持していくには十分なりソースがあるということになる。</p>

<p><img src="/mol/images/2017/1206-08.png" width="250" alt=""></p>

<p>51％以上のシェアがあるからといって、誰かのビットコインを盗むことも、署名なしにビットコインを使うことも、ビットコインの支払先をか書き換えることも、過去のトランザクションや記録の所有者を変えることもできない。しかし、これから行われる取引に対して、ダブルスペンド（二重使用）が可能となる。ただこれも改ざん不可能と考えられている 6 承認（Six Confirmations）を待ってからビットコインの支払いを受けつけるようにすれば回避できるかもしれない。</p>

<p>なににせよ、特定の誰かがマイニングシェアを牛耳ることは、非中央集権のシステムではよくない。GMO、DMM、SBI などの日本勢がマイニング事業に乗り出すということなので、願わくば頑張っていい感じにして欲しい（雑）。</p>

<p>おわり。</p>

<p>4 日目の<a href="//twitter.com/sonatard">@sonatard</a>がもっと詳しい<a href="//medium.com/@sonatard12/asicboost%E3%81%A8segwit%E3%81%AE%E9%96%A2%E4%BF%82-56a7c8429341">記事</a>書いてくれてる。</p>

<h2 id="参考">参考</h2>

<ul>
<li><a href="http://gaiax-blockchain.com/pow">ブロックチェーンの健全性を支えるマイニング</a></li>
<li><a href="http://gaiax-blockchain.com/halving">マイニングの報酬額を半減させるタイミング「半減期」</a></li>
<li><a href="http://gaiax-blockchain.com/utxo">ブロックチェーンの取引データをひとつなぎにする仕組み「UTXO」</a></li>
<li><a href="http://gaiax-blockchain.com/merkle-tree">トランザクションデータを要約する技術「マークルツリー」</a></li>
<li><a href="http://gaiax-blockchain.com/51-percent">ブロックチェーンが特定のグループに支配されてしまう問題「51%問題」</a></li>
</ul>

    </section>
  </article>

  
  <div class="post-tags"><a href="/mol/categories/development/">development</a> </div>
  

  <div class="post-social">
  <a href="http://b.hatena.ne.jp/add?mode=confirm&title=%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e3%83%81%e3%82%a7%e3%83%bc%e3%83%b3%e3%81%a8%e3%83%9e%e3%82%a4%e3%83%8b%e3%83%b3%e3%82%b0 - MOL&url=https%3a%2f%2ft32k.me%2fmol%2flog%2fhow-bitcoin-mining-works%2f" title="はてなブックマークで共有する"
    target="_blank" rel="noopener"><svg>
      <use xlink:href="#post-hb" /></svg></a>
  <a href="https://twitter.com/share?url=https%3a%2f%2ft32k.me%2fmol%2flog%2fhow-bitcoin-mining-works%2f&text=%e3%83%96%e3%83%ad%e3%83%83%e3%82%af%e3%83%81%e3%82%a7%e3%83%bc%e3%83%b3%e3%81%a8%e3%83%9e%e3%82%a4%e3%83%8b%e3%83%b3%e3%82%b0 - MOL" title="Twitterで共有する"
    target="_blank" rel="noopener"><svg>
      <use xlink:href="#post-tw" /></svg></a>
  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ft32k.me%2fmol%2flog%2fhow-bitcoin-mining-works%2f" title="Facebookで共有する" target="_blank" rel="noopener"><svg>
      <use xlink:href="#post-fb" /></svg></a>
</div>
  <hr>
  <div class="site-ad">
  <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-1326877318485833" data-ad-slot="7307465775"
    data-ad-format="auto"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div>
  <hr>
<div class="row post-pager">
  <div class="six columns">
    <div class="post-previous">  Later article<br>
      <a href="https://t32k.me/mol/log/978-4774194004-chou-soku/"> 超速！ Webページ速度改善ガイド</a>  </div>
  </div>
  <div class="six columns">
    <div class="post-next">  Older article<br>
      <a href="https://t32k.me/mol/log/circleci2-yml/"> CircleCI 2.0でGAE/Node.jsのプロジェクトをデプロイ</a>  </div>
  </div>
</div>
  
</div>
<footer class="site-footer">
  <div class="container">
    <div class="site-author u-cf">
      <p class="u-pull-left"><a href="/">
          <img src="/mol/images/people/me.jpg" width="80" height="80" alt="t32k" class="site-author-pic"></a></p>
      <div class="site-author-info">
        <p class="site-author-desc">石本 光司（いしもと こうじ）1983年石川県生まれ。大学でデザインを専攻後、晴れてWebデザイナーになるが、コーディング好きが高じてWebデベロッパーに転身。</p>
        <ul class="social-links">
          <li><a href="//t32k.me/mol/index.xml" title="RSS">
              <svg class="social-links-rss">
                <use xlink:href="#shape-rss" /></svg>
            </a></li>
          </a></li>
          <li><a href="//github.com/t32k" title="GitHub">
              <svg class="social-links-github">
                <use xlink:href="#shape-github" /></svg>
            </a></li>
          <li><a href="//dribbble.com/t32k" title="Dribbble">
              <svg class="social-links-dribbble">
                <use xlink:href="#shape-dribbble" /></svg>
            </a></li>
          <li><a href="//www.linkedin.com/in/kojiishimoto" title="LinkedIn">
              <svg class="social-links-linkedin">
                <use xlink:href="#shape-linkedin" /></svg>
            </a></li>
        </ul>
      </div>
    </div>
    <p class="site-copyright"><small role="contentinfo">&copy; 2007 t32k.me</small></p>
    
  </div>
</footer>
  </body>

  </html>