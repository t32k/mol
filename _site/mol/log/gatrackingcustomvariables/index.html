<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Analytics カスタム変数ガイド &mdash; MOL</title>
    <link href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/assets/main.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/images/logo.png"/>
    <link href="/feed.xml" rel="alternate" type="application/rss+xml" title="MOL" />
    <meta name="title" content="Google Analytics カスタム変数ガイド ">
    <link rel="canonical" href="http://t32k.me//mol/log/gatrackingcustomvariables">
     
           
    <meta property="og:title" content="Google Analytics カスタム変数ガイド "/>
    <meta property="og:url" content="http://t32k.me//mol/log/gatrackingcustomvariables"/>
    
    
    <!--meta property="og:description" content="<p><cite>原文：<a href="http://code.google.com/apis/analytics/docs/tracking/gaTrackingCustomVariables.html">Custom Variables - Google Analytics - Google Code</a></cite>
<ul>
    <li><a href="#overview">概要</a></li>
    <li><a href="#examples">カスタム変数の使用</a></li>
    <li><a href="#setup">使用例</a></li>
    <li><a href="#usage">使用上のガイドライン</a></li>
</ul>
カスタム変数は名前-値がペアになったもので、Google Analyticsのトラッキング機能を強化するために、トラッキングコードに追加することができます。カスタム変数を使えば、あらかじめGoogle Analyticsから提供されているセグメント以外に、サイトビジターに対して新たなセグメントを追加することができます。このドキュメントはカスタム変数とその設定方法について説明します。</p>

<p>&lt;!--more--&gt;<strong>概要</strong></p>

<p><img class="alignright size-full wp-image-1802" title="level" src="http://t32k.me/mol/file/2010/10/level.png" alt="" width="200" height="171" /></p>

<p>もしあなたがGoogle Analyticsを使用してユーザーの基本的なインタラクションモデルを理解しようとするならば、カスタム変数から多くのことを得るでしょう。このモデルにおいて、ユーザーはサイトのコンテンツと特定の期間にわたって関与し、サイトに対するエンゲージメントは以下のような階層に分類することができます。</p>

<p>この図はサイトに訪れた1人のユーザーを表していて、各々のブロックは特定のユーザーのセッション数やインタラクション数を表現しています。</p>

<p>このモデルの各段階は、次のとおりに定義されます。
<ul>
    <li><strong>ビジター -</strong> 人によって操作されるブラウザや携帯電話のようなサイトを訪れるクライアント</li>
    <li><strong>セッション -</strong> ユーザーがアクティブに活動している期間</li>
    <li><strong>ページ -</strong> GIFリクエストをAnalyticsサーバに送る活動。これは一般的にページビューと特徴付けられまするが、以下のものも含めます
<ul>
    <li>ページビュー</li>
    <li>イベント（例. ムービーボタンをクリックするなど）</li>
</ul>
</li>
</ul>
これら3つのインタラクションの段階はユーザーのエンゲージメントの範囲を構成しています。これはカスタム変数にとって重要なことです。なぜなら、各々のカスタム変数は特定の範囲に限定されるからです。例えば、ショッピングカートから商品を放棄したページのセッション数を知りたいとします。このケースにおいて、オンラインカートから商品を放棄したとフラグ付けされたユーザーの全てのセッションを把握するために、あなたはカスタム変数をセッションレベルで定義するでしょう。
<h3 id="examples"><strong>カスタム変数の使用</strong></h3>
ユーザーの活動をトラッキングするためにさまざまなカスタム変数を設定するのであれば、通常、それを管理するためのJavaScriptユーティリティが必要になるでしょう。カスタム変数を使用するための基本的な設定方法は以下のとおりです。
<pre><em>setCustomVar(インデックス, 変数名, 値, スコープ)</pre>
このメソッドは4つの引数を持つことができます。
<ul>
    <li><strong>インデックス -</strong> カスタム変数のスロット（箱）です。これは1から5の数値をとります。1つのカスタム変数は1つのスロットに格納すべきで、異なるスロット間で再利用はできません。</li>
    <li><strong>変数名 -</strong> カスタム変数の名前。これはカスタム変数名を表す文字列で、レポートメニューのに『カスタム変数』のトップ階層に表示されます。</li>
    <li><strong>値 -</strong> カスタム変数の値です。変数名とペアになっている文字列です。1つの変数名からいくつもの値を関連付けることができます。この値はレポートメニューからカスタム変数の名前を選択すると、リストで表示されます。たいてい、2つ以上の値を持っています。例えば、「性別」というカスタム変数名を定義した場合、値は「男性」と「女性」になるでしょう。</li>
    <li><strong>スコープ</strong>（オプション）<strong> -</strong> カスタム変数の適用範囲。前述の通り、スコープはサイトとユーザーの関わりのレベルを定義します。1（ビジターレベル）, 2（セッションレベル）, 3（ページレベル）の数値を使用します。もし未定義の場合、デフォルトはページレベルになります。</li>
</ul>
次のスニペットは、ショッピングカートから商品を放棄したページをトラッキングするためのカスタム変数設定について説明します。ここでは</em>setCustomVar()メソッドは、<em>trackEvent()メソッドの直前で実行しています。そのため、</em>trackEvent()メソッドによってGIFリクエストが生成されてまとめて情報が送られます。そしてユーザーの活動を定義付けるために、Items Removedの変数名とYesの値を使用しています。加えて、Items Removed変数名のNoの値をデフォルトに設定することは意味をなしています。この方法の場合、あなたはショッピングカートの商品を放棄したユーザー数を知っていて、商品放棄数を含めないビジター数も知っていることです。
<pre><span style="color: #808080;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　1, 　　　　　　　　　　<span style="color: #800000;">// このカスタム変数はスロット１に格納する</span>
　　&#39;Items Removed&#39;, 　　　<span style="color: #800000;">// ユーザーの行動の種類の名前</span>
　　&#39;Yes&#39;,　　　　　　　　 <span style="color: #800000;">// カスタム変数の値</span>
　　2 　　　　　　　　　　 <span style="color: #800000;">// スコープをセッションレベルに設定</span>
<span style="color: #808080;">]);</span>
<span style="color: #808080;"><em>gaq.push([</span>&#39;</em>trackEvent&#39;,
　　&#39;Shopping&#39;,　　　　  <span style="color: #800000;">// カテゴリ名</span>
　　&#39;Item Removal&#39; 　　 <span style="color: #800000;">// アクション名</span>
<span style="color: #808080;">]);</span></pre>
カスタム変数を設定すれば、<a href="http://code.google.com/apis/analytics/docs/gaJS/gaJSApiBasicConfiguration.html#_gat.GA_Tracker_._deleteCustomVar">_deleteCustomVar(index)</a>を使用して設定した変数を消去することも可能です。
<h3 id="setup"><strong>使用例</strong></h3>
カスタム変数は様々な方法で実装することが可能で、ビジネス要件とサイト構造次第です。以下の、3つのスコープレベルの使用例を研究します。
<ul>
    <li><a href="#pageLevel">ページレベル カスタム変数</a></li>
    <li><a href="#sessionLevel">セッションレベル カスタム変数</a></li>
    <li><a href="#visitorLevel">ビジターレベル カスタム変数</a></li>
</ul>
<h4 id="pageLevel"><strong>ページレベル カスタム変数</strong></h4>
ページでのユーザーの活動を明確にするにはページレベルカスタム変数を使用してください。</p>

<p>例えば、いろんな記事があるオンラインニュースサイトを運営しているとしましょう。ある記事が最も人気があるかどうか理解するのは簡単です。しかも、今回はカスタム変数を使用することでニュースのどのセクションが人気であるのか確認することができます。これはページレベルのカスタム変数を使用し、各記事のセクションをカスタム変数の値として設定すれば可能です。例えば、ライフスタイル、投書、ビジネス欄のようなセクションを持っていたとします。あなたは全ての記事のセクションをトラッキングするためにカスタム変数を設定することができます。
<pre><span style="color: #888888;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　1, 　　　　　　　　　<span style="color: #800000;">// 1番のスロットにカスタム変数を設定する</span>
　　&#39;Section&#39;, 　　　　　<span style="color: #800000;">// オンラインコンテンツのトップカテゴリーの名前</span>
　　&#39;Life &amp; Style&#39;, 　　<span style="color: #800000;">// &quot;Section&quot;の値に&quot;Life &amp; Style&quot;を設定</span>
　　3 　　　　　　　　　<span style="color: #800000;">// ページレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
さらに、特定の記事のセクションだけでなくサブセクションもタグづけしたくなるような提案をしましょう。例えば、先程のライフスタイルのセクションは、フード＆ドリンク、ファッション、スポーツのようなサブセクションをいくつか持っているとします。それで、あなたはセクション、サブセクション両方ともトラッキング可能です。全ての記事のサブセクションをトラッキングするためのカスタム変数を追加して設定することができます。
<pre><span style="color: #888888;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　2, 　　　　　　　　　<span style="color: #800000;">// 2番のスロットにカスタム変数を設定する</span>
　　&#39;Sub-Section&#39;, 　　　<span style="color: #800000;">// オンラインコンテンツのセカンドレベルの名前</span>
　　&#39;Fashion&#39;, 　　　　　<span style="color: #800000;">// &quot;Sub-Section&quot;の値に&quot;Fashion&quot;を設定</span>
　　3 　　　　　　　　　<span style="color: #800000;">// ページレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
この例においては、ひとつのページに対して、2つのページレベルのカスタム変数を同時に設定しました。どのページにおいても、最大で5つのカスタム変数を別々のスロットに格納してトラッキングすることが可能です。つまり、同じページであと3つ、カスタム変数を設定することが可能です。全ての記事において、様々なセクション、サブセクションをトラッキングするためのいくつものページレベルのカスタム変数を設定することができます。詳細なページレベルのカスタム変数の設定の仕方については<a id="fd20" title="下記の使用上のガイドライン" href="#usage">下記の使用上のガイドライン</a>をご覧ください。
<h4 id="sessionLevel"><strong>セッションレベル カスタム変数</strong></h4>
ユーザー体験を区別するにはセッションレベルのカスタム変数を使用してください。例えば、もし、あなたのサイトがログイン機能を有しているのであれば、ユーザーのログイン状態を判別するためにセッションレベルのカスタム変数を使用します。それで、あなたはログインメンバーかそうでないか区別することができます。
<pre><span style="color: #888888;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　1, 　　　　　　　<span style="color: #800000;">// 1番のスロットにカスタム変数を設定</span>
　　&#39;User Type&#39;,　　 <span style="color: #800000;">// カスタム変数名</span>
　　&#39;Member&#39;, 　　　 <span style="color: #800000;">// &quot;User Type&quot;の値に&quot;Member&quot; or &quot;Visitor&quot;を状態によって設定する</span>
　　2 　　　　　　　<span style="color: #800000;">// セッションレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
&quot;User Type&quot;と一緒に、セッション内で購入を試みたかどうかもトラッキングしてはどうでしょう。もし、全てのページでログインできるのであれば、&quot;User Type&quot;のためにスロット１は空けておき、購入を試みたかどうかは別のスロットを使用すればよいでしょう。
<pre><span style="color: #888888;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　2, 　　　　　　　　　　　　<span style="color: #800000;">// 2番のスロットにカスタム変数を設定</span>
　　&#39;Shopping Attempts&#39;, 　　<span style="color: #800000;">// カスタム変数名</span>
　　&#39;Yes&#39;,　　　　　　　　　　 <span style="color: #800000;">// 値 （デフォルト値はNOに設定しているだろう）</span>
　　2 　　　　　　　　　　　　<span style="color: #800000;">// セッションレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
<h4 id="visitorLevel"><strong>ビジターレベル カスタム変数</strong></h4>
複数のセッション間でユーザーを区別したいときはビジターレベルのカスタム変数を使用してください。</p>

<p>例えば、もしあなたのサイトで有料購読者にプレミアムコンテンツを提供しているのであれば、どのユーザーが有料購読者なのか、どのくらい支払ってるのか、どのユーザーが無料サービスを受けているかなど、分析するためにビジターレベルのカスタム変数を設定することができます。この値はクッキーが存在する限り有効なので、１度設定すれば問題ないでしょう。
<pre><span style="color: #888888;"><em>gaq.push(</span>[&#39;</em>setCustomVar&#39;,
  1,               <span style="color: #800000;"> 　　// 1番のスロットにカスタム変数を設定</span>
  &#39;Member Type&#39;,   <span style="color: #800000;"> // カスタム変数名</span>
  &#39;Premium&#39;,       <span style="color: #800000;"> // 値(値はFree,Bronze,Gold,かPlatinumのどれかだろう)</span>
  1                 　<span style="color: #800000;">// ビジターレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
<h3 id="usage">使用上のガイドライン</h3>
このセクションでは、様々な種類のカスタム変数と正しい使用方法の違いについて説明します。
<ul>
    <li><a href="#varTypes">カスタム変数の種類</a></li>
    <li><a href="#mixedTypes">ミックス型変数</a></li>
    <li><a href="#recommended">推奨するプラクティス</a></li>
</ul>
<h4 id="varTypes">カスタム変数の種類</h4>
すべてのカスタム変数は、<strong>変数名と値の連結した長さが64バイトでなければらない</strong></p>

<p>これは変数名と値の文字列が64バイトを超えてはならないことを意味します。</p>

<p>以下の表はカスタム変数の種類ごとの主な特徴がまとめてあります。異なる種類のカスタム変数が同じスロットで使用されている場合の制限事項を留意しておいてください。
<table>
<tbody>
<tr>
<td width="10%" align="left" valign="top" bgcolor="#cfe2f3"></td>
<td width="25%" align="left" valign="top" bgcolor="#cfe2f3">期間</td>
<td width="25%" valign="top" bgcolor="#cfe2f3">他の変数とスロットを共有した場合</td>
<td width="25%" align="left" valign="top" bgcolor="#cfe2f3">許容値</td>
</tr>
<tr>
<td width="10%" align="left" valign="top" bgcolor="#cfe2f3">ページレベル</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">1回のPV、イベントもしくはトランザクション</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">そのページで呼び出された最後のページレベル変数が適用される</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">サイトにおいて、セッション中のヒット数の限り、ページレベル変数を多数設定でき、スロットを再利用できます。</p>

<p>１つのページにおいては、最大で5つまでのページレベル変数を同時に設定することできる</td>
</tr>
<tr>
<td width="10%" align="left" valign="top" bgcolor="#cfe2f3">セッションレベル</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">ユーザーのセッション中</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">そのセッションで呼び出された最後のセッションレベル変数が使用される</p>

<p><strong>例. </strong>もし、スロット１に<span style="color: #008000;">login=false</span>がセッションの初めに記録されていて、後に<span style="color: #008000;">login=true</span>がセットされればそのセッションは<span style="color: #008000;">login=true</span>で記録される</p>

<p>同じセッション中で事前に設定されたページレベル変数を上書きする</p>

<p><strong>例.</strong> もし、スロット１で初めにc<span style="color: #008000;">ategory=sports</span>が使用されていて、その後に<span style="color: #008000;">login=true</span>が適用されれば、<span style="color: #008000;">category=sport</span>はこのセッションでは記録されない</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">サイトにおいて、64キロバイト内のキーと値の組み合わせと同数のセッションレベル変数を設定可能です。</p>

<p>（但し、GAが1日を通して集約される限界値は50,000）</p>

<p>セッションにおいては、最大で5つまでのセッションレベル変数を設定することできる</td>
</tr>
<tr>
<td width="10%" align="left" valign="top" bgcolor="#cfe2f3">ビジターレベル</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">クッキーが存在する限り</p>

<p>設定するとそれ以降の訪問すべてに適用される（それ以前、現在の訪問には適用されない）</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">最後に設定されたビジターレベル変数がそのユーザーに関連付けられる</p>

<p>同じセッション中で事前に設定されたカスタム変数を上書きする</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">サイトにおいて、最大で5つまでのビジターレベル変数を設定することできる</td>
</tr>
</tbody>
</table>
<h4 id="mixedTypes">ミックス型変数</h4>
複数のページ・セッション・ビジターレベルのカスタム変数を使用する場合、スロットの再利用は慎重に考えなければなりません。もし、ページもしくはセッションレベル変数が同じ時に同じスロットに設定されたページレベル変数を使用するケースが起こった場合、 ページもしくはセッションレベル変数しか記録されないでしょう。</p>

<p>次のシナリオはある1人のユーザーが同じブラウザでの活動。ページ、セッション、ビジターレベルのカスタム変数が混在して設定されたページについて説明します。(1), (2)は使用されているスロット番号を示し、S：はスコープを表しています。</p>

<p><strong>ケース１　1セッション、3ページビュー</strong>
<table>
<tbody>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション1</td>
<td width="25%" bgcolor="#fafafa">Page 1
(1)  S:ページレベル
<span style="color: #008000;"> section=opinion</span></td>
<td width="25%" bgcolor="#fafafa">Page 2
(1)  S:セッションレベル
<span style="color: #008000;"> login=true</span></td>
<td width="25%" bgcolor="#fafafa">Page 3
(1)  S:セッションレベル
<span style="color: #008000;"> converted=true</span></td>
</tr>
</tbody>
</table>
このセッションレポートは以下のようになります、
<ul>
    <li>section=opinion セッション：0</li>
    <li>login=true セッション：0</li>
    <li>converted=true セッション：1</li>
</ul>
最後に訪れたページで呼ばれたセッションレベル変数が同じスロットで再利用され、それが優先的にレポートに受信されたのです。</p>

<p><strong>ケース2　3セッション</strong><strong> </strong>
<table>
<tbody>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション1</td>
<td width="33.333333333333336%" bgcolor="#fafafa">Page 1
(1)  S:ビジターレベル
<span style="color: #008000;"> gender=male</span></td>
<td width="33.333333333333336%" bgcolor="#fafafa"></td>
</tr>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション2</td>
<td width="33.333333333333336%" bgcolor="#fafafa">(2)  S:セッションレベル
<span style="color: #008000;"> converted=false</span></td>
<td width="33.333333333333336%" bgcolor="#fafafa"></td>
</tr>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション3</td>
<td width="33.333333333333336%" bgcolor="#fafafa">(1)  S:ページレベル
<span style="color: #008000;"> section=opinion</span></td>
<td width="33.333333333333336%" bgcolor="#fafafa">Page 2
(1)  S:セッションレベル
<span style="color: #008000;"> converted=false</span></td>
</tr>
</tbody>
</table>
このセッションレポートは以下のようになります、
<ul>
    <li>section=opinion セッション：1</li>
    <li>gender=male セッション：2</li>
    <li>converted=false セッション：2</li>
</ul>
ここでは、ビジターレベル変数が設定された後に、同じスロットでページレベル変数が使用されています。このため、ビジターレベル変数はページレベル変数を上書きしません。</p>

<p><strong>ケース3　3セッション、1ページビュー</strong><strong> </strong>
<table>
<tbody>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション1</td>
<td width="50%" bgcolor="#fafafa">Page 1
(1)  S:ビジターレベル
<span style="color: #008000;"> gender=male</span></td>
</tr>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション2</td>
<td width="50%" bgcolor="#fafafa">(2)  S:セッションレベル
<span style="color: #008000;"> converted=false</span></td>
</tr>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション3</td>
<td width="50%" bgcolor="#fafafa">(1)  S:ページレベル
<span style="color: #008000;"> section=opinion</span></td>
</tr>
</tbody>
</table>
このセッションレポートは以下のようになります、
<ul>
    <li>section=opinion セッション：1</li>
    <li>gender=male セッション：2</li>
    <li>converted=false セッション：1</li>
</ul>
最後のセッションで1つのカスタム変数だけを再利用しています。ケース2との違いに注意してください。
<h4 id="recommended">推奨するプラクティス</h4>
<ul>
    <li><strong>スロット間での変数名の重複は避けてください。
</strong></li>
    <li><strong>１回のリクエス</strong>ト（PVまたはイベント）<strong>で同時に5つまでのカスタム変数を使用することが出来ます。
</strong>いかなるリクエストだろうと、あなたが持てるカスタム変数は5つをまでです。すなわち、5つのビジターレベル変数と5つセッションレベル変数を同時に設定することはできません。</li>
    <li><strong>ページビュー・イベントのGIFリクエストよりも前に<span style="color: #008000;"><em>setCustomVar()</span>関数呼び出してください。</strong>
あるケースにおいては不可能かもしれませんし、カスタム変数を設定した後に、別の</em>trackPageview（）リクエストをする必要が出てくるでしょう。このようなケースは、ユーザートリガーで設定されるセッション・ビジターレベル変数や、ページビュー、イベント、Eコマーストラッキングなどのメソッドにカスタム変数をまとめることが不可能な状況において、考えなければなりません。</li>
    <li><strong>多くのカスタム変数をトラッキングする場合はスロット表を作成してください。</strong>
もし、ページレベルとセッションレベル変数の混在した状態で、複雑なトラッキング要求仕様を抱えているのであれば、セッションレベル変数がベージレベル変数を不用意に上書きさせないためにも、スロット表を作成し管理するべきでしょう。</li>
    <li><strong>アプリケーションをトラッキングする場合は、カスタム変数よりもイベントトラッキングの使用を検討してください。</strong>
例えば、あなたがオンラインミュージックストアを運営していて、ログインしたセッション、購入を試みたセッション、視聴サンプルが再生されたセッションともにトラッキングしたいとします。視聴サンプルの再生数を知りたい場合は、セッションレベル変数を使うよりもイベントトラッキングを使用したほうが合理的です。なぜなら、イベントトラッキングの4番目の値パラメータを使用すればクッキーにセッションデータを渡すことも可能です。</li>
    <li><strong>ページレベル変数でトラッキング可能な行動をセッションレベル変数でトラッキングしないでください。
</strong>例えば、ログイン状態、購入を試みている状態のセッション数をトラッキングし、&quot;メンバースペシャル&quot;ページもまたトラッキングしたいとします。ページレベル変数は特定の変数のセッション数も示しますので、あなたは既に必要なセッション数を少なくとも1回のページビューも含めて理解することができます。</li>
</ul></p>
"/>
    <meta name="description" content="<p><cite>原文：<a href="http://code.google.com/apis/analytics/docs/tracking/gaTrackingCustomVariables.html">Custom Variables - Google Analytics - Google Code</a></cite>
<ul>
    <li><a href="#overview">概要</a></li>
    <li><a href="#examples">カスタム変数の使用</a></li>
    <li><a href="#setup">使用例</a></li>
    <li><a href="#usage">使用上のガイドライン</a></li>
</ul>
カスタム変数は名前-値がペアになったもので、Google Analyticsのトラッキング機能を強化するために、トラッキングコードに追加することができます。カスタム変数を使えば、あらかじめGoogle Analyticsから提供されているセグメント以外に、サイトビジターに対して新たなセグメントを追加することができます。このドキュメントはカスタム変数とその設定方法について説明します。</p>

<p>&lt;!--more--&gt;<strong>概要</strong></p>

<p><img class="alignright size-full wp-image-1802" title="level" src="http://t32k.me/mol/file/2010/10/level.png" alt="" width="200" height="171" /></p>

<p>もしあなたがGoogle Analyticsを使用してユーザーの基本的なインタラクションモデルを理解しようとするならば、カスタム変数から多くのことを得るでしょう。このモデルにおいて、ユーザーはサイトのコンテンツと特定の期間にわたって関与し、サイトに対するエンゲージメントは以下のような階層に分類することができます。</p>

<p>この図はサイトに訪れた1人のユーザーを表していて、各々のブロックは特定のユーザーのセッション数やインタラクション数を表現しています。</p>

<p>このモデルの各段階は、次のとおりに定義されます。
<ul>
    <li><strong>ビジター -</strong> 人によって操作されるブラウザや携帯電話のようなサイトを訪れるクライアント</li>
    <li><strong>セッション -</strong> ユーザーがアクティブに活動している期間</li>
    <li><strong>ページ -</strong> GIFリクエストをAnalyticsサーバに送る活動。これは一般的にページビューと特徴付けられまするが、以下のものも含めます
<ul>
    <li>ページビュー</li>
    <li>イベント（例. ムービーボタンをクリックするなど）</li>
</ul>
</li>
</ul>
これら3つのインタラクションの段階はユーザーのエンゲージメントの範囲を構成しています。これはカスタム変数にとって重要なことです。なぜなら、各々のカスタム変数は特定の範囲に限定されるからです。例えば、ショッピングカートから商品を放棄したページのセッション数を知りたいとします。このケースにおいて、オンラインカートから商品を放棄したとフラグ付けされたユーザーの全てのセッションを把握するために、あなたはカスタム変数をセッションレベルで定義するでしょう。
<h3 id="examples"><strong>カスタム変数の使用</strong></h3>
ユーザーの活動をトラッキングするためにさまざまなカスタム変数を設定するのであれば、通常、それを管理するためのJavaScriptユーティリティが必要になるでしょう。カスタム変数を使用するための基本的な設定方法は以下のとおりです。
<pre><em>setCustomVar(インデックス, 変数名, 値, スコープ)</pre>
このメソッドは4つの引数を持つことができます。
<ul>
    <li><strong>インデックス -</strong> カスタム変数のスロット（箱）です。これは1から5の数値をとります。1つのカスタム変数は1つのスロットに格納すべきで、異なるスロット間で再利用はできません。</li>
    <li><strong>変数名 -</strong> カスタム変数の名前。これはカスタム変数名を表す文字列で、レポートメニューのに『カスタム変数』のトップ階層に表示されます。</li>
    <li><strong>値 -</strong> カスタム変数の値です。変数名とペアになっている文字列です。1つの変数名からいくつもの値を関連付けることができます。この値はレポートメニューからカスタム変数の名前を選択すると、リストで表示されます。たいてい、2つ以上の値を持っています。例えば、「性別」というカスタム変数名を定義した場合、値は「男性」と「女性」になるでしょう。</li>
    <li><strong>スコープ</strong>（オプション）<strong> -</strong> カスタム変数の適用範囲。前述の通り、スコープはサイトとユーザーの関わりのレベルを定義します。1（ビジターレベル）, 2（セッションレベル）, 3（ページレベル）の数値を使用します。もし未定義の場合、デフォルトはページレベルになります。</li>
</ul>
次のスニペットは、ショッピングカートから商品を放棄したページをトラッキングするためのカスタム変数設定について説明します。ここでは</em>setCustomVar()メソッドは、<em>trackEvent()メソッドの直前で実行しています。そのため、</em>trackEvent()メソッドによってGIFリクエストが生成されてまとめて情報が送られます。そしてユーザーの活動を定義付けるために、Items Removedの変数名とYesの値を使用しています。加えて、Items Removed変数名のNoの値をデフォルトに設定することは意味をなしています。この方法の場合、あなたはショッピングカートの商品を放棄したユーザー数を知っていて、商品放棄数を含めないビジター数も知っていることです。
<pre><span style="color: #808080;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　1, 　　　　　　　　　　<span style="color: #800000;">// このカスタム変数はスロット１に格納する</span>
　　&#39;Items Removed&#39;, 　　　<span style="color: #800000;">// ユーザーの行動の種類の名前</span>
　　&#39;Yes&#39;,　　　　　　　　 <span style="color: #800000;">// カスタム変数の値</span>
　　2 　　　　　　　　　　 <span style="color: #800000;">// スコープをセッションレベルに設定</span>
<span style="color: #808080;">]);</span>
<span style="color: #808080;"><em>gaq.push([</span>&#39;</em>trackEvent&#39;,
　　&#39;Shopping&#39;,　　　　  <span style="color: #800000;">// カテゴリ名</span>
　　&#39;Item Removal&#39; 　　 <span style="color: #800000;">// アクション名</span>
<span style="color: #808080;">]);</span></pre>
カスタム変数を設定すれば、<a href="http://code.google.com/apis/analytics/docs/gaJS/gaJSApiBasicConfiguration.html#_gat.GA_Tracker_._deleteCustomVar">_deleteCustomVar(index)</a>を使用して設定した変数を消去することも可能です。
<h3 id="setup"><strong>使用例</strong></h3>
カスタム変数は様々な方法で実装することが可能で、ビジネス要件とサイト構造次第です。以下の、3つのスコープレベルの使用例を研究します。
<ul>
    <li><a href="#pageLevel">ページレベル カスタム変数</a></li>
    <li><a href="#sessionLevel">セッションレベル カスタム変数</a></li>
    <li><a href="#visitorLevel">ビジターレベル カスタム変数</a></li>
</ul>
<h4 id="pageLevel"><strong>ページレベル カスタム変数</strong></h4>
ページでのユーザーの活動を明確にするにはページレベルカスタム変数を使用してください。</p>

<p>例えば、いろんな記事があるオンラインニュースサイトを運営しているとしましょう。ある記事が最も人気があるかどうか理解するのは簡単です。しかも、今回はカスタム変数を使用することでニュースのどのセクションが人気であるのか確認することができます。これはページレベルのカスタム変数を使用し、各記事のセクションをカスタム変数の値として設定すれば可能です。例えば、ライフスタイル、投書、ビジネス欄のようなセクションを持っていたとします。あなたは全ての記事のセクションをトラッキングするためにカスタム変数を設定することができます。
<pre><span style="color: #888888;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　1, 　　　　　　　　　<span style="color: #800000;">// 1番のスロットにカスタム変数を設定する</span>
　　&#39;Section&#39;, 　　　　　<span style="color: #800000;">// オンラインコンテンツのトップカテゴリーの名前</span>
　　&#39;Life &amp; Style&#39;, 　　<span style="color: #800000;">// &quot;Section&quot;の値に&quot;Life &amp; Style&quot;を設定</span>
　　3 　　　　　　　　　<span style="color: #800000;">// ページレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
さらに、特定の記事のセクションだけでなくサブセクションもタグづけしたくなるような提案をしましょう。例えば、先程のライフスタイルのセクションは、フード＆ドリンク、ファッション、スポーツのようなサブセクションをいくつか持っているとします。それで、あなたはセクション、サブセクション両方ともトラッキング可能です。全ての記事のサブセクションをトラッキングするためのカスタム変数を追加して設定することができます。
<pre><span style="color: #888888;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　2, 　　　　　　　　　<span style="color: #800000;">// 2番のスロットにカスタム変数を設定する</span>
　　&#39;Sub-Section&#39;, 　　　<span style="color: #800000;">// オンラインコンテンツのセカンドレベルの名前</span>
　　&#39;Fashion&#39;, 　　　　　<span style="color: #800000;">// &quot;Sub-Section&quot;の値に&quot;Fashion&quot;を設定</span>
　　3 　　　　　　　　　<span style="color: #800000;">// ページレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
この例においては、ひとつのページに対して、2つのページレベルのカスタム変数を同時に設定しました。どのページにおいても、最大で5つのカスタム変数を別々のスロットに格納してトラッキングすることが可能です。つまり、同じページであと3つ、カスタム変数を設定することが可能です。全ての記事において、様々なセクション、サブセクションをトラッキングするためのいくつものページレベルのカスタム変数を設定することができます。詳細なページレベルのカスタム変数の設定の仕方については<a id="fd20" title="下記の使用上のガイドライン" href="#usage">下記の使用上のガイドライン</a>をご覧ください。
<h4 id="sessionLevel"><strong>セッションレベル カスタム変数</strong></h4>
ユーザー体験を区別するにはセッションレベルのカスタム変数を使用してください。例えば、もし、あなたのサイトがログイン機能を有しているのであれば、ユーザーのログイン状態を判別するためにセッションレベルのカスタム変数を使用します。それで、あなたはログインメンバーかそうでないか区別することができます。
<pre><span style="color: #888888;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　1, 　　　　　　　<span style="color: #800000;">// 1番のスロットにカスタム変数を設定</span>
　　&#39;User Type&#39;,　　 <span style="color: #800000;">// カスタム変数名</span>
　　&#39;Member&#39;, 　　　 <span style="color: #800000;">// &quot;User Type&quot;の値に&quot;Member&quot; or &quot;Visitor&quot;を状態によって設定する</span>
　　2 　　　　　　　<span style="color: #800000;">// セッションレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
&quot;User Type&quot;と一緒に、セッション内で購入を試みたかどうかもトラッキングしてはどうでしょう。もし、全てのページでログインできるのであれば、&quot;User Type&quot;のためにスロット１は空けておき、購入を試みたかどうかは別のスロットを使用すればよいでしょう。
<pre><span style="color: #888888;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　2, 　　　　　　　　　　　　<span style="color: #800000;">// 2番のスロットにカスタム変数を設定</span>
　　&#39;Shopping Attempts&#39;, 　　<span style="color: #800000;">// カスタム変数名</span>
　　&#39;Yes&#39;,　　　　　　　　　　 <span style="color: #800000;">// 値 （デフォルト値はNOに設定しているだろう）</span>
　　2 　　　　　　　　　　　　<span style="color: #800000;">// セッションレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
<h4 id="visitorLevel"><strong>ビジターレベル カスタム変数</strong></h4>
複数のセッション間でユーザーを区別したいときはビジターレベルのカスタム変数を使用してください。</p>

<p>例えば、もしあなたのサイトで有料購読者にプレミアムコンテンツを提供しているのであれば、どのユーザーが有料購読者なのか、どのくらい支払ってるのか、どのユーザーが無料サービスを受けているかなど、分析するためにビジターレベルのカスタム変数を設定することができます。この値はクッキーが存在する限り有効なので、１度設定すれば問題ないでしょう。
<pre><span style="color: #888888;"><em>gaq.push(</span>[&#39;</em>setCustomVar&#39;,
  1,               <span style="color: #800000;"> 　　// 1番のスロットにカスタム変数を設定</span>
  &#39;Member Type&#39;,   <span style="color: #800000;"> // カスタム変数名</span>
  &#39;Premium&#39;,       <span style="color: #800000;"> // 値(値はFree,Bronze,Gold,かPlatinumのどれかだろう)</span>
  1                 　<span style="color: #800000;">// ビジターレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
<h3 id="usage">使用上のガイドライン</h3>
このセクションでは、様々な種類のカスタム変数と正しい使用方法の違いについて説明します。
<ul>
    <li><a href="#varTypes">カスタム変数の種類</a></li>
    <li><a href="#mixedTypes">ミックス型変数</a></li>
    <li><a href="#recommended">推奨するプラクティス</a></li>
</ul>
<h4 id="varTypes">カスタム変数の種類</h4>
すべてのカスタム変数は、<strong>変数名と値の連結した長さが64バイトでなければらない</strong></p>

<p>これは変数名と値の文字列が64バイトを超えてはならないことを意味します。</p>

<p>以下の表はカスタム変数の種類ごとの主な特徴がまとめてあります。異なる種類のカスタム変数が同じスロットで使用されている場合の制限事項を留意しておいてください。
<table>
<tbody>
<tr>
<td width="10%" align="left" valign="top" bgcolor="#cfe2f3"></td>
<td width="25%" align="left" valign="top" bgcolor="#cfe2f3">期間</td>
<td width="25%" valign="top" bgcolor="#cfe2f3">他の変数とスロットを共有した場合</td>
<td width="25%" align="left" valign="top" bgcolor="#cfe2f3">許容値</td>
</tr>
<tr>
<td width="10%" align="left" valign="top" bgcolor="#cfe2f3">ページレベル</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">1回のPV、イベントもしくはトランザクション</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">そのページで呼び出された最後のページレベル変数が適用される</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">サイトにおいて、セッション中のヒット数の限り、ページレベル変数を多数設定でき、スロットを再利用できます。</p>

<p>１つのページにおいては、最大で5つまでのページレベル変数を同時に設定することできる</td>
</tr>
<tr>
<td width="10%" align="left" valign="top" bgcolor="#cfe2f3">セッションレベル</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">ユーザーのセッション中</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">そのセッションで呼び出された最後のセッションレベル変数が使用される</p>

<p><strong>例. </strong>もし、スロット１に<span style="color: #008000;">login=false</span>がセッションの初めに記録されていて、後に<span style="color: #008000;">login=true</span>がセットされればそのセッションは<span style="color: #008000;">login=true</span>で記録される</p>

<p>同じセッション中で事前に設定されたページレベル変数を上書きする</p>

<p><strong>例.</strong> もし、スロット１で初めにc<span style="color: #008000;">ategory=sports</span>が使用されていて、その後に<span style="color: #008000;">login=true</span>が適用されれば、<span style="color: #008000;">category=sport</span>はこのセッションでは記録されない</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">サイトにおいて、64キロバイト内のキーと値の組み合わせと同数のセッションレベル変数を設定可能です。</p>

<p>（但し、GAが1日を通して集約される限界値は50,000）</p>

<p>セッションにおいては、最大で5つまでのセッションレベル変数を設定することできる</td>
</tr>
<tr>
<td width="10%" align="left" valign="top" bgcolor="#cfe2f3">ビジターレベル</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">クッキーが存在する限り</p>

<p>設定するとそれ以降の訪問すべてに適用される（それ以前、現在の訪問には適用されない）</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">最後に設定されたビジターレベル変数がそのユーザーに関連付けられる</p>

<p>同じセッション中で事前に設定されたカスタム変数を上書きする</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">サイトにおいて、最大で5つまでのビジターレベル変数を設定することできる</td>
</tr>
</tbody>
</table>
<h4 id="mixedTypes">ミックス型変数</h4>
複数のページ・セッション・ビジターレベルのカスタム変数を使用する場合、スロットの再利用は慎重に考えなければなりません。もし、ページもしくはセッションレベル変数が同じ時に同じスロットに設定されたページレベル変数を使用するケースが起こった場合、 ページもしくはセッションレベル変数しか記録されないでしょう。</p>

<p>次のシナリオはある1人のユーザーが同じブラウザでの活動。ページ、セッション、ビジターレベルのカスタム変数が混在して設定されたページについて説明します。(1), (2)は使用されているスロット番号を示し、S：はスコープを表しています。</p>

<p><strong>ケース１　1セッション、3ページビュー</strong>
<table>
<tbody>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション1</td>
<td width="25%" bgcolor="#fafafa">Page 1
(1)  S:ページレベル
<span style="color: #008000;"> section=opinion</span></td>
<td width="25%" bgcolor="#fafafa">Page 2
(1)  S:セッションレベル
<span style="color: #008000;"> login=true</span></td>
<td width="25%" bgcolor="#fafafa">Page 3
(1)  S:セッションレベル
<span style="color: #008000;"> converted=true</span></td>
</tr>
</tbody>
</table>
このセッションレポートは以下のようになります、
<ul>
    <li>section=opinion セッション：0</li>
    <li>login=true セッション：0</li>
    <li>converted=true セッション：1</li>
</ul>
最後に訪れたページで呼ばれたセッションレベル変数が同じスロットで再利用され、それが優先的にレポートに受信されたのです。</p>

<p><strong>ケース2　3セッション</strong><strong> </strong>
<table>
<tbody>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション1</td>
<td width="33.333333333333336%" bgcolor="#fafafa">Page 1
(1)  S:ビジターレベル
<span style="color: #008000;"> gender=male</span></td>
<td width="33.333333333333336%" bgcolor="#fafafa"></td>
</tr>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション2</td>
<td width="33.333333333333336%" bgcolor="#fafafa">(2)  S:セッションレベル
<span style="color: #008000;"> converted=false</span></td>
<td width="33.333333333333336%" bgcolor="#fafafa"></td>
</tr>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション3</td>
<td width="33.333333333333336%" bgcolor="#fafafa">(1)  S:ページレベル
<span style="color: #008000;"> section=opinion</span></td>
<td width="33.333333333333336%" bgcolor="#fafafa">Page 2
(1)  S:セッションレベル
<span style="color: #008000;"> converted=false</span></td>
</tr>
</tbody>
</table>
このセッションレポートは以下のようになります、
<ul>
    <li>section=opinion セッション：1</li>
    <li>gender=male セッション：2</li>
    <li>converted=false セッション：2</li>
</ul>
ここでは、ビジターレベル変数が設定された後に、同じスロットでページレベル変数が使用されています。このため、ビジターレベル変数はページレベル変数を上書きしません。</p>

<p><strong>ケース3　3セッション、1ページビュー</strong><strong> </strong>
<table>
<tbody>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション1</td>
<td width="50%" bgcolor="#fafafa">Page 1
(1)  S:ビジターレベル
<span style="color: #008000;"> gender=male</span></td>
</tr>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション2</td>
<td width="50%" bgcolor="#fafafa">(2)  S:セッションレベル
<span style="color: #008000;"> converted=false</span></td>
</tr>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション3</td>
<td width="50%" bgcolor="#fafafa">(1)  S:ページレベル
<span style="color: #008000;"> section=opinion</span></td>
</tr>
</tbody>
</table>
このセッションレポートは以下のようになります、
<ul>
    <li>section=opinion セッション：1</li>
    <li>gender=male セッション：2</li>
    <li>converted=false セッション：1</li>
</ul>
最後のセッションで1つのカスタム変数だけを再利用しています。ケース2との違いに注意してください。
<h4 id="recommended">推奨するプラクティス</h4>
<ul>
    <li><strong>スロット間での変数名の重複は避けてください。
</strong></li>
    <li><strong>１回のリクエス</strong>ト（PVまたはイベント）<strong>で同時に5つまでのカスタム変数を使用することが出来ます。
</strong>いかなるリクエストだろうと、あなたが持てるカスタム変数は5つをまでです。すなわち、5つのビジターレベル変数と5つセッションレベル変数を同時に設定することはできません。</li>
    <li><strong>ページビュー・イベントのGIFリクエストよりも前に<span style="color: #008000;"><em>setCustomVar()</span>関数呼び出してください。</strong>
あるケースにおいては不可能かもしれませんし、カスタム変数を設定した後に、別の</em>trackPageview（）リクエストをする必要が出てくるでしょう。このようなケースは、ユーザートリガーで設定されるセッション・ビジターレベル変数や、ページビュー、イベント、Eコマーストラッキングなどのメソッドにカスタム変数をまとめることが不可能な状況において、考えなければなりません。</li>
    <li><strong>多くのカスタム変数をトラッキングする場合はスロット表を作成してください。</strong>
もし、ページレベルとセッションレベル変数の混在した状態で、複雑なトラッキング要求仕様を抱えているのであれば、セッションレベル変数がベージレベル変数を不用意に上書きさせないためにも、スロット表を作成し管理するべきでしょう。</li>
    <li><strong>アプリケーションをトラッキングする場合は、カスタム変数よりもイベントトラッキングの使用を検討してください。</strong>
例えば、あなたがオンラインミュージックストアを運営していて、ログインしたセッション、購入を試みたセッション、視聴サンプルが再生されたセッションともにトラッキングしたいとします。視聴サンプルの再生数を知りたい場合は、セッションレベル変数を使うよりもイベントトラッキングを使用したほうが合理的です。なぜなら、イベントトラッキングの4番目の値パラメータを使用すればクッキーにセッションデータを渡すことも可能です。</li>
    <li><strong>ページレベル変数でトラッキング可能な行動をセッションレベル変数でトラッキングしないでください。
</strong>例えば、ログイン状態、購入を試みている状態のセッション数をトラッキングし、&quot;メンバースペシャル&quot;ページもまたトラッキングしたいとします。ページレベル変数は特定の変数のセッション数も示しますので、あなたは既に必要なセッション数を少なくとも1回のページビューも含めて理解することができます。</li>
</ul></p>
"/-->
    
    <meta property="og:site_name" content="MOL">     
</head>
<body>
    
<section class="site-nav">
    <header>
        <nav id="navigation">
            <a class="brand" href="/">
                <img src="/images/logo.png" alt="Inc">
            </a>
            <a href="/" class="home">Blog</a>
            <a href="https://github.com/t32k/maple">Maple</a>
            <a href="https://github.com/t32k/t32k.github.io/blob/master/README.md">About</a>
        </nav>
    </header>
</section>


<article>

    <div class="container">
        <header>
            <div class="meta">
                By <address><a rel="author" href="" title="" target="_blank"></a> &mdash;
                <time pubdate datetime="2010-08-October" title="October 08, 2010">October 08, 2010</time>
            </div>
            <h1 class="title">Google Analytics カスタム変数ガイド</h1>
            
        </header>

        <section>
            <p><cite>原文：<a href="http://code.google.com/apis/analytics/docs/tracking/gaTrackingCustomVariables.html">Custom Variables - Google Analytics - Google Code</a></cite>
<ul>
    <li><a href="#overview">概要</a></li>
    <li><a href="#examples">カスタム変数の使用</a></li>
    <li><a href="#setup">使用例</a></li>
    <li><a href="#usage">使用上のガイドライン</a></li>
</ul>
カスタム変数は名前-値がペアになったもので、Google Analyticsのトラッキング機能を強化するために、トラッキングコードに追加することができます。カスタム変数を使えば、あらかじめGoogle Analyticsから提供されているセグメント以外に、サイトビジターに対して新たなセグメントを追加することができます。このドキュメントはカスタム変数とその設定方法について説明します。</p>

<p>&lt;!--more--&gt;<strong>概要</strong></p>

<p><img class="alignright size-full wp-image-1802" title="level" src="http://t32k.me/mol/file/2010/10/level.png" alt="" width="200" height="171" /></p>

<p>もしあなたがGoogle Analyticsを使用してユーザーの基本的なインタラクションモデルを理解しようとするならば、カスタム変数から多くのことを得るでしょう。このモデルにおいて、ユーザーはサイトのコンテンツと特定の期間にわたって関与し、サイトに対するエンゲージメントは以下のような階層に分類することができます。</p>

<p>この図はサイトに訪れた1人のユーザーを表していて、各々のブロックは特定のユーザーのセッション数やインタラクション数を表現しています。</p>

<p>このモデルの各段階は、次のとおりに定義されます。
<ul>
    <li><strong>ビジター -</strong> 人によって操作されるブラウザや携帯電話のようなサイトを訪れるクライアント</li>
    <li><strong>セッション -</strong> ユーザーがアクティブに活動している期間</li>
    <li><strong>ページ -</strong> GIFリクエストをAnalyticsサーバに送る活動。これは一般的にページビューと特徴付けられまするが、以下のものも含めます
<ul>
    <li>ページビュー</li>
    <li>イベント（例. ムービーボタンをクリックするなど）</li>
</ul>
</li>
</ul>
これら3つのインタラクションの段階はユーザーのエンゲージメントの範囲を構成しています。これはカスタム変数にとって重要なことです。なぜなら、各々のカスタム変数は特定の範囲に限定されるからです。例えば、ショッピングカートから商品を放棄したページのセッション数を知りたいとします。このケースにおいて、オンラインカートから商品を放棄したとフラグ付けされたユーザーの全てのセッションを把握するために、あなたはカスタム変数をセッションレベルで定義するでしょう。
<h3 id="examples"><strong>カスタム変数の使用</strong></h3>
ユーザーの活動をトラッキングするためにさまざまなカスタム変数を設定するのであれば、通常、それを管理するためのJavaScriptユーティリティが必要になるでしょう。カスタム変数を使用するための基本的な設定方法は以下のとおりです。
<pre><em>setCustomVar(インデックス, 変数名, 値, スコープ)</pre>
このメソッドは4つの引数を持つことができます。
<ul>
    <li><strong>インデックス -</strong> カスタム変数のスロット（箱）です。これは1から5の数値をとります。1つのカスタム変数は1つのスロットに格納すべきで、異なるスロット間で再利用はできません。</li>
    <li><strong>変数名 -</strong> カスタム変数の名前。これはカスタム変数名を表す文字列で、レポートメニューのに『カスタム変数』のトップ階層に表示されます。</li>
    <li><strong>値 -</strong> カスタム変数の値です。変数名とペアになっている文字列です。1つの変数名からいくつもの値を関連付けることができます。この値はレポートメニューからカスタム変数の名前を選択すると、リストで表示されます。たいてい、2つ以上の値を持っています。例えば、「性別」というカスタム変数名を定義した場合、値は「男性」と「女性」になるでしょう。</li>
    <li><strong>スコープ</strong>（オプション）<strong> -</strong> カスタム変数の適用範囲。前述の通り、スコープはサイトとユーザーの関わりのレベルを定義します。1（ビジターレベル）, 2（セッションレベル）, 3（ページレベル）の数値を使用します。もし未定義の場合、デフォルトはページレベルになります。</li>
</ul>
次のスニペットは、ショッピングカートから商品を放棄したページをトラッキングするためのカスタム変数設定について説明します。ここでは</em>setCustomVar()メソッドは、<em>trackEvent()メソッドの直前で実行しています。そのため、</em>trackEvent()メソッドによってGIFリクエストが生成されてまとめて情報が送られます。そしてユーザーの活動を定義付けるために、Items Removedの変数名とYesの値を使用しています。加えて、Items Removed変数名のNoの値をデフォルトに設定することは意味をなしています。この方法の場合、あなたはショッピングカートの商品を放棄したユーザー数を知っていて、商品放棄数を含めないビジター数も知っていることです。
<pre><span style="color: #808080;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　1, 　　　　　　　　　　<span style="color: #800000;">// このカスタム変数はスロット１に格納する</span>
　　&#39;Items Removed&#39;, 　　　<span style="color: #800000;">// ユーザーの行動の種類の名前</span>
　　&#39;Yes&#39;,　　　　　　　　 <span style="color: #800000;">// カスタム変数の値</span>
　　2 　　　　　　　　　　 <span style="color: #800000;">// スコープをセッションレベルに設定</span>
<span style="color: #808080;">]);</span>
<span style="color: #808080;"><em>gaq.push([</span>&#39;</em>trackEvent&#39;,
　　&#39;Shopping&#39;,　　　　  <span style="color: #800000;">// カテゴリ名</span>
　　&#39;Item Removal&#39; 　　 <span style="color: #800000;">// アクション名</span>
<span style="color: #808080;">]);</span></pre>
カスタム変数を設定すれば、<a href="http://code.google.com/apis/analytics/docs/gaJS/gaJSApiBasicConfiguration.html#_gat.GA_Tracker_._deleteCustomVar">_deleteCustomVar(index)</a>を使用して設定した変数を消去することも可能です。
<h3 id="setup"><strong>使用例</strong></h3>
カスタム変数は様々な方法で実装することが可能で、ビジネス要件とサイト構造次第です。以下の、3つのスコープレベルの使用例を研究します。
<ul>
    <li><a href="#pageLevel">ページレベル カスタム変数</a></li>
    <li><a href="#sessionLevel">セッションレベル カスタム変数</a></li>
    <li><a href="#visitorLevel">ビジターレベル カスタム変数</a></li>
</ul>
<h4 id="pageLevel"><strong>ページレベル カスタム変数</strong></h4>
ページでのユーザーの活動を明確にするにはページレベルカスタム変数を使用してください。</p>

<p>例えば、いろんな記事があるオンラインニュースサイトを運営しているとしましょう。ある記事が最も人気があるかどうか理解するのは簡単です。しかも、今回はカスタム変数を使用することでニュースのどのセクションが人気であるのか確認することができます。これはページレベルのカスタム変数を使用し、各記事のセクションをカスタム変数の値として設定すれば可能です。例えば、ライフスタイル、投書、ビジネス欄のようなセクションを持っていたとします。あなたは全ての記事のセクションをトラッキングするためにカスタム変数を設定することができます。
<pre><span style="color: #888888;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　1, 　　　　　　　　　<span style="color: #800000;">// 1番のスロットにカスタム変数を設定する</span>
　　&#39;Section&#39;, 　　　　　<span style="color: #800000;">// オンラインコンテンツのトップカテゴリーの名前</span>
　　&#39;Life &amp; Style&#39;, 　　<span style="color: #800000;">// &quot;Section&quot;の値に&quot;Life &amp; Style&quot;を設定</span>
　　3 　　　　　　　　　<span style="color: #800000;">// ページレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
さらに、特定の記事のセクションだけでなくサブセクションもタグづけしたくなるような提案をしましょう。例えば、先程のライフスタイルのセクションは、フード＆ドリンク、ファッション、スポーツのようなサブセクションをいくつか持っているとします。それで、あなたはセクション、サブセクション両方ともトラッキング可能です。全ての記事のサブセクションをトラッキングするためのカスタム変数を追加して設定することができます。
<pre><span style="color: #888888;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　2, 　　　　　　　　　<span style="color: #800000;">// 2番のスロットにカスタム変数を設定する</span>
　　&#39;Sub-Section&#39;, 　　　<span style="color: #800000;">// オンラインコンテンツのセカンドレベルの名前</span>
　　&#39;Fashion&#39;, 　　　　　<span style="color: #800000;">// &quot;Sub-Section&quot;の値に&quot;Fashion&quot;を設定</span>
　　3 　　　　　　　　　<span style="color: #800000;">// ページレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
この例においては、ひとつのページに対して、2つのページレベルのカスタム変数を同時に設定しました。どのページにおいても、最大で5つのカスタム変数を別々のスロットに格納してトラッキングすることが可能です。つまり、同じページであと3つ、カスタム変数を設定することが可能です。全ての記事において、様々なセクション、サブセクションをトラッキングするためのいくつものページレベルのカスタム変数を設定することができます。詳細なページレベルのカスタム変数の設定の仕方については<a id="fd20" title="下記の使用上のガイドライン" href="#usage">下記の使用上のガイドライン</a>をご覧ください。
<h4 id="sessionLevel"><strong>セッションレベル カスタム変数</strong></h4>
ユーザー体験を区別するにはセッションレベルのカスタム変数を使用してください。例えば、もし、あなたのサイトがログイン機能を有しているのであれば、ユーザーのログイン状態を判別するためにセッションレベルのカスタム変数を使用します。それで、あなたはログインメンバーかそうでないか区別することができます。
<pre><span style="color: #888888;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　1, 　　　　　　　<span style="color: #800000;">// 1番のスロットにカスタム変数を設定</span>
　　&#39;User Type&#39;,　　 <span style="color: #800000;">// カスタム変数名</span>
　　&#39;Member&#39;, 　　　 <span style="color: #800000;">// &quot;User Type&quot;の値に&quot;Member&quot; or &quot;Visitor&quot;を状態によって設定する</span>
　　2 　　　　　　　<span style="color: #800000;">// セッションレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
&quot;User Type&quot;と一緒に、セッション内で購入を試みたかどうかもトラッキングしてはどうでしょう。もし、全てのページでログインできるのであれば、&quot;User Type&quot;のためにスロット１は空けておき、購入を試みたかどうかは別のスロットを使用すればよいでしょう。
<pre><span style="color: #888888;"><em>gaq.push([</span>&#39;</em>setCustomVar&#39;,
　　2, 　　　　　　　　　　　　<span style="color: #800000;">// 2番のスロットにカスタム変数を設定</span>
　　&#39;Shopping Attempts&#39;, 　　<span style="color: #800000;">// カスタム変数名</span>
　　&#39;Yes&#39;,　　　　　　　　　　 <span style="color: #800000;">// 値 （デフォルト値はNOに設定しているだろう）</span>
　　2 　　　　　　　　　　　　<span style="color: #800000;">// セッションレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
<h4 id="visitorLevel"><strong>ビジターレベル カスタム変数</strong></h4>
複数のセッション間でユーザーを区別したいときはビジターレベルのカスタム変数を使用してください。</p>

<p>例えば、もしあなたのサイトで有料購読者にプレミアムコンテンツを提供しているのであれば、どのユーザーが有料購読者なのか、どのくらい支払ってるのか、どのユーザーが無料サービスを受けているかなど、分析するためにビジターレベルのカスタム変数を設定することができます。この値はクッキーが存在する限り有効なので、１度設定すれば問題ないでしょう。
<pre><span style="color: #888888;"><em>gaq.push(</span>[&#39;</em>setCustomVar&#39;,
  1,               <span style="color: #800000;"> 　　// 1番のスロットにカスタム変数を設定</span>
  &#39;Member Type&#39;,   <span style="color: #800000;"> // カスタム変数名</span>
  &#39;Premium&#39;,       <span style="color: #800000;"> // 値(値はFree,Bronze,Gold,かPlatinumのどれかだろう)</span>
  1                 　<span style="color: #800000;">// ビジターレベルのスコープを設定</span>
<span style="color: #888888;">]);</span></pre>
<h3 id="usage">使用上のガイドライン</h3>
このセクションでは、様々な種類のカスタム変数と正しい使用方法の違いについて説明します。
<ul>
    <li><a href="#varTypes">カスタム変数の種類</a></li>
    <li><a href="#mixedTypes">ミックス型変数</a></li>
    <li><a href="#recommended">推奨するプラクティス</a></li>
</ul>
<h4 id="varTypes">カスタム変数の種類</h4>
すべてのカスタム変数は、<strong>変数名と値の連結した長さが64バイトでなければらない</strong></p>

<p>これは変数名と値の文字列が64バイトを超えてはならないことを意味します。</p>

<p>以下の表はカスタム変数の種類ごとの主な特徴がまとめてあります。異なる種類のカスタム変数が同じスロットで使用されている場合の制限事項を留意しておいてください。
<table>
<tbody>
<tr>
<td width="10%" align="left" valign="top" bgcolor="#cfe2f3"></td>
<td width="25%" align="left" valign="top" bgcolor="#cfe2f3">期間</td>
<td width="25%" valign="top" bgcolor="#cfe2f3">他の変数とスロットを共有した場合</td>
<td width="25%" align="left" valign="top" bgcolor="#cfe2f3">許容値</td>
</tr>
<tr>
<td width="10%" align="left" valign="top" bgcolor="#cfe2f3">ページレベル</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">1回のPV、イベントもしくはトランザクション</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">そのページで呼び出された最後のページレベル変数が適用される</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">サイトにおいて、セッション中のヒット数の限り、ページレベル変数を多数設定でき、スロットを再利用できます。</p>

<p>１つのページにおいては、最大で5つまでのページレベル変数を同時に設定することできる</td>
</tr>
<tr>
<td width="10%" align="left" valign="top" bgcolor="#cfe2f3">セッションレベル</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">ユーザーのセッション中</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">そのセッションで呼び出された最後のセッションレベル変数が使用される</p>

<p><strong>例. </strong>もし、スロット１に<span style="color: #008000;">login=false</span>がセッションの初めに記録されていて、後に<span style="color: #008000;">login=true</span>がセットされればそのセッションは<span style="color: #008000;">login=true</span>で記録される</p>

<p>同じセッション中で事前に設定されたページレベル変数を上書きする</p>

<p><strong>例.</strong> もし、スロット１で初めにc<span style="color: #008000;">ategory=sports</span>が使用されていて、その後に<span style="color: #008000;">login=true</span>が適用されれば、<span style="color: #008000;">category=sport</span>はこのセッションでは記録されない</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">サイトにおいて、64キロバイト内のキーと値の組み合わせと同数のセッションレベル変数を設定可能です。</p>

<p>（但し、GAが1日を通して集約される限界値は50,000）</p>

<p>セッションにおいては、最大で5つまでのセッションレベル変数を設定することできる</td>
</tr>
<tr>
<td width="10%" align="left" valign="top" bgcolor="#cfe2f3">ビジターレベル</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">クッキーが存在する限り</p>

<p>設定するとそれ以降の訪問すべてに適用される（それ以前、現在の訪問には適用されない）</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">最後に設定されたビジターレベル変数がそのユーザーに関連付けられる</p>

<p>同じセッション中で事前に設定されたカスタム変数を上書きする</td>
<td width="25%" align="left" valign="top" bgcolor="#fafafa">サイトにおいて、最大で5つまでのビジターレベル変数を設定することできる</td>
</tr>
</tbody>
</table>
<h4 id="mixedTypes">ミックス型変数</h4>
複数のページ・セッション・ビジターレベルのカスタム変数を使用する場合、スロットの再利用は慎重に考えなければなりません。もし、ページもしくはセッションレベル変数が同じ時に同じスロットに設定されたページレベル変数を使用するケースが起こった場合、 ページもしくはセッションレベル変数しか記録されないでしょう。</p>

<p>次のシナリオはある1人のユーザーが同じブラウザでの活動。ページ、セッション、ビジターレベルのカスタム変数が混在して設定されたページについて説明します。(1), (2)は使用されているスロット番号を示し、S：はスコープを表しています。</p>

<p><strong>ケース１　1セッション、3ページビュー</strong>
<table>
<tbody>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション1</td>
<td width="25%" bgcolor="#fafafa">Page 1
(1)  S:ページレベル
<span style="color: #008000;"> section=opinion</span></td>
<td width="25%" bgcolor="#fafafa">Page 2
(1)  S:セッションレベル
<span style="color: #008000;"> login=true</span></td>
<td width="25%" bgcolor="#fafafa">Page 3
(1)  S:セッションレベル
<span style="color: #008000;"> converted=true</span></td>
</tr>
</tbody>
</table>
このセッションレポートは以下のようになります、
<ul>
    <li>section=opinion セッション：0</li>
    <li>login=true セッション：0</li>
    <li>converted=true セッション：1</li>
</ul>
最後に訪れたページで呼ばれたセッションレベル変数が同じスロットで再利用され、それが優先的にレポートに受信されたのです。</p>

<p><strong>ケース2　3セッション</strong><strong> </strong>
<table>
<tbody>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション1</td>
<td width="33.333333333333336%" bgcolor="#fafafa">Page 1
(1)  S:ビジターレベル
<span style="color: #008000;"> gender=male</span></td>
<td width="33.333333333333336%" bgcolor="#fafafa"></td>
</tr>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション2</td>
<td width="33.333333333333336%" bgcolor="#fafafa">(2)  S:セッションレベル
<span style="color: #008000;"> converted=false</span></td>
<td width="33.333333333333336%" bgcolor="#fafafa"></td>
</tr>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション3</td>
<td width="33.333333333333336%" bgcolor="#fafafa">(1)  S:ページレベル
<span style="color: #008000;"> section=opinion</span></td>
<td width="33.333333333333336%" bgcolor="#fafafa">Page 2
(1)  S:セッションレベル
<span style="color: #008000;"> converted=false</span></td>
</tr>
</tbody>
</table>
このセッションレポートは以下のようになります、
<ul>
    <li>section=opinion セッション：1</li>
    <li>gender=male セッション：2</li>
    <li>converted=false セッション：2</li>
</ul>
ここでは、ビジターレベル変数が設定された後に、同じスロットでページレベル変数が使用されています。このため、ビジターレベル変数はページレベル変数を上書きしません。</p>

<p><strong>ケース3　3セッション、1ページビュー</strong><strong> </strong>
<table>
<tbody>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション1</td>
<td width="50%" bgcolor="#fafafa">Page 1
(1)  S:ビジターレベル
<span style="color: #008000;"> gender=male</span></td>
</tr>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション2</td>
<td width="50%" bgcolor="#fafafa">(2)  S:セッションレベル
<span style="color: #008000;"> converted=false</span></td>
</tr>
<tr>
<td width="15%" bgcolor="#cfe2f3">セッション3</td>
<td width="50%" bgcolor="#fafafa">(1)  S:ページレベル
<span style="color: #008000;"> section=opinion</span></td>
</tr>
</tbody>
</table>
このセッションレポートは以下のようになります、
<ul>
    <li>section=opinion セッション：1</li>
    <li>gender=male セッション：2</li>
    <li>converted=false セッション：1</li>
</ul>
最後のセッションで1つのカスタム変数だけを再利用しています。ケース2との違いに注意してください。
<h4 id="recommended">推奨するプラクティス</h4>
<ul>
    <li><strong>スロット間での変数名の重複は避けてください。
</strong></li>
    <li><strong>１回のリクエス</strong>ト（PVまたはイベント）<strong>で同時に5つまでのカスタム変数を使用することが出来ます。
</strong>いかなるリクエストだろうと、あなたが持てるカスタム変数は5つをまでです。すなわち、5つのビジターレベル変数と5つセッションレベル変数を同時に設定することはできません。</li>
    <li><strong>ページビュー・イベントのGIFリクエストよりも前に<span style="color: #008000;"><em>setCustomVar()</span>関数呼び出してください。</strong>
あるケースにおいては不可能かもしれませんし、カスタム変数を設定した後に、別の</em>trackPageview（）リクエストをする必要が出てくるでしょう。このようなケースは、ユーザートリガーで設定されるセッション・ビジターレベル変数や、ページビュー、イベント、Eコマーストラッキングなどのメソッドにカスタム変数をまとめることが不可能な状況において、考えなければなりません。</li>
    <li><strong>多くのカスタム変数をトラッキングする場合はスロット表を作成してください。</strong>
もし、ページレベルとセッションレベル変数の混在した状態で、複雑なトラッキング要求仕様を抱えているのであれば、セッションレベル変数がベージレベル変数を不用意に上書きさせないためにも、スロット表を作成し管理するべきでしょう。</li>
    <li><strong>アプリケーションをトラッキングする場合は、カスタム変数よりもイベントトラッキングの使用を検討してください。</strong>
例えば、あなたがオンラインミュージックストアを運営していて、ログインしたセッション、購入を試みたセッション、視聴サンプルが再生されたセッションともにトラッキングしたいとします。視聴サンプルの再生数を知りたい場合は、セッションレベル変数を使うよりもイベントトラッキングを使用したほうが合理的です。なぜなら、イベントトラッキングの4番目の値パラメータを使用すればクッキーにセッションデータを渡すことも可能です。</li>
    <li><strong>ページレベル変数でトラッキング可能な行動をセッションレベル変数でトラッキングしないでください。
</strong>例えば、ログイン状態、購入を試みている状態のセッション数をトラッキングし、&quot;メンバースペシャル&quot;ページもまたトラッキングしたいとします。ページレベル変数は特定の変数のセッション数も示しますので、あなたは既に必要なセッション数を少なくとも1回のページビューも含めて理解することができます。</li>
</ul></p>

            
<div class="social">
    <div>
        <a href="https://twitter.com/share" class="twitter-share-button"  data-text="Google Analytics カスタム変数ガイド" data-related="t32k">Tweet</a>
    </div>
    
    
    <div>
        <div class="fb-like" data-width="150" data-layout="button_count" data-action="like" data-show-faces="true" data-send="false"></div>
    </div>
    
    
    <div>
        <div class="g-plusone" data-size="medium"></div>
    </div>
    
    
</div>

        </section>

        <footer>
            <address>
               
                <p>Written by <strong><a rel="author" href="https://twitter.com/" title="" target="_blank"></a></strong><br>
                <span class="muted"></span>
                </p>
            </address>

        </footer>

        
    </div>
</article>

<footer class="site-footer">
    <div class="container">
        &copy; 2013 
        
        <nav>
            <a href="http://t32k.me/">MOL</a> &middot;
            <a href="/">Blog</a> &middot;
            <a href="https://github.com/t32k/maple">Maple</a> &middot; 
            <a href="https://github.com/t32k/t32k.github.io/blob/master/README.md">About</a>
        </nav>
        
        <nav class="social">
            
            <a href="https://twitter.com/t32k" title="Follow on Twitter" target="_blank"><i class="icon icon-twitter black"></i></a>
            
            
            <a href="http://facebook.com/t32k" title="Follow on Facebook" target="_blank"><i class="icon icon-facebook black"></i></a>
                
            <a href="/feed.xml" title="RSS Feed">
                <i class="icon icon-rss black"></i>
            </a>
        </nav>
        <p>Incorporated theme by <a href="https://sendtoinc.com">Inc</a></p>
    </div>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script src="/assets/main.js"></script>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=253595308025739";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>



</body>
</html>