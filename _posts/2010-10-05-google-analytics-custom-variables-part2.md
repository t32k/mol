---
layout: post
title: Google Analytics カスタム変数、パート2：コードぜよ！
categories:
- analytics
- translate
tags:
- google analytics
status: publish
type: post
published: true
meta:
  _edit_last: '1'
  pvc_views: '4921'
---
<cite>原文： <a href="http://www.lunametrics.com/blog/2010/04/23/custom-variables-part-ii-code/">Custom Variables, Part II: The Code</a>
投稿日：2010-4-23 by Jonathan</cite>

<a href="http://t32k.me/mol/2010/10/google-analytics-custom-variables-part1/">前回の記事</a>において、なぜカスタム変数に関心を持つべきか話してきた。今回は君のサイトでの実装方法について見てみよう。
<h3>カスタム変数を設定する</h3>
カスタム変数のコードはとても簡単でひとつの関数だけで済むんだ。（もし、以前にユーザー定義の_setVar関数を使っていたのなら、いくつかのパラメータを除いて実装は極めて似ている。） こんな感じだよ。
<pre>_gaq.push(['_setCustomVar', index, name, value, scope]);</pre>
4つのパラメータの意味は以下の通り

<!--more-->
<ul>
	<li>インデックス（index）は変数を格納するスロット、なぜなら複数のカスタム変数を持てるからね。これは1から5の数字である。スロットの使用方法は少々難しくなるので、より深い考察は後日するよ。</li>
	<li>変数名（name）と値（value）は、カスタム変数を識別するのに一緒に機能するんだ。"eyes" と "blue", "member" と "yes", "section" と "yes"のような変数名と値を持つことになるだろう。変数名は変数について特定し、値は適用するラベルだ。変数名と値を合わせた文字列は最大で64バイトまでに抑えなければならない。</li>
	<li>スコープ（scope）は変数がビジター、セッション、ページレベルのいずれかに適用されていることを表す。（<a href="http://t32k.me/mol/2010/10/google-analytics-custom-variables-part1/#scopes_and_how_to_use_them">パート1のスコープについて</a>を参照してくれ）スコープは1がビジター、2がセッション、3がページビューレベルです。もし設定し忘れたら、デフォルトは1になるよ。</li>
</ul>
では、例を見てみよう
<pre>_gaq.push(['_setCustomVar', 1, 'eyes', 'value', 1]);</pre>
このメソッドは、スロット1にeyes=blueを、ビジターレベルでカスタム変数を設定するってことだ。で合ってるよね？
<h3>どこで値を知るんだい？</h3>
_setVarとsetCustomVar の値をどのように書き込めばいいのか、ということは最も一般的な疑問の１つだ。あるケースに置いて、値はそれが適用されるすべての人にとって同じものだ（"member"="yes"のような）。しかし、瞳の色に関して言えば、青い目の人と茶色の目の人をどのように動的に区別するのだろうか？

そうだね、まず第一に君はすでにどうにかする方法知っているんだ。彼らの目の色を尋ねた時の調査票や、サイトの登録もしくは購入したときに情報を埋め込んだ質問フォームなど君は持っているだろう。値がいつ発生しようとも、それがどこであろうとも格納することができる、たぶんクッキーだったりデータベースだったり。

それから、カスタム変数のコードに動的に記入したいだろう。しかし、詳しい記述の仕方は値を呼び出す場所や、ページがどのようなシステム（ASP、PHPなど）で構成されているか次第なんだけど、基本的なアプローチは以下のような感じ。
<pre>_gaq.push(['_setCustomVar', 1, 'eyes', &lt;&lt; 動的に瞳の色を記述 &gt;&gt;, 1]）；</pre>
<h3>コードはどこに設置すべきか？</h3>
OK、コードを理解したらどこに設置したらいいんだい？

これには２つのガイドラインがある。まず最初は、取得したい情報を得るために適したページに置くことだ。　もし、”メンバー”カスタム変数ならば、ログイン後にメンバーが踏むページにコードを設置すればいいだろう。もし、”セクション”カスタム変数ならば、それぞれ個別のセクションページにコードを設置する（"widgets"や"about us"や"find a store"などのセクションを見た人を記録する）。もしそれが瞳の色だったら、その情報を取得したページに置くのがもっとも簡単だろう。

2番目に、_trackPageview (もしくは _trackEvent）よりも前にコードを設置することは重要なことだ。なぜならば、カスタム変数の情報はページビューの情報と一緒に送られるからね。
<h3>僕らは真ん中にいる</h3>
これでカスタム変数を記録するに必要な情報は全部だ。しかし、まだスロットについて話してないね。それはパート3におあずけだ。なぜならちょっと複雑だからね。

--

<span style="color: #888888;">※コード例は非同期版に変更しました。</span>
