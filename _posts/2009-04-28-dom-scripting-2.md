---
layout: post
title: DOMから始めるJavaScriptモダン・スクリプティング　１〜５回まで
categories:
- javascript
tags: []
status: publish
type: post
published: true
meta:
  blogger_blog: warikiru.blogspot.com
  blogger_author: t32khttp://www.blogger.com/profile/06797489791220082722noreply@blogger.com
  blogger_permalink: /2009/04/dom-scripting-futomi-01.html
  _edit_last: '1'
  pvc_views: '4229'
---
<a href="http://itpro.nikkeibp.co.jp/article/COLUMN/20070626/275913/">DOMから始めるJavaScriptモダン・スクリプティング---目次：ITpro</a> より<br />サイ本はちょっと休憩<br /><br /><br />DOM（Document Object Model）<br /><pre>&lt;body&gt;<br />&lt;h1&gt;タイトル&lt;/h1&gt;<br />&lt;p&gt;文章 1&lt;/p&gt;<br />&lt;p&gt;文章 2&lt;/p&gt;<br />&lt;/body&gt;</pre><br /><pre>var elm = document.getElementsByTagName('P').item(1);</pre><br />↑2つ目のP要素を参照する。DOMを使うことでHTML上のあらゆる要素にJavaScriptからアクセスできるようになる。<h5>DOMで扱う範囲</h5><ul><li>Core：HTML/XMLの要素にアクセスするための方法</li><li>HTML：HTMLに特化した要素へのアクセス方法</li><li>Event：マウスクリックなどのイベントの扱い方</li><li>Style：スタイルシートへのアクセス方法</li></ul><br /><br /><h5>DOMの歴史</h5><pre>if(navigator.appName == "Netscape"){<br />　/* Netscape Navigatorの場合 */<br />　ver version = perseFloat(navigator.appVersion);<br />　if(version &gt;= 4) {<br />　　/* Ver4の場合 */<br />　} else {<br />　　/* ver4未満の場合 */<br />　}<br />} else if(navigator.appName == "Microsoft Internet Exploer") {<br />　/* Internet Exploerの場合 */<br />　var ua = navigator.userAgent;<br />　var offset = ua.indexOf("MSIE");<br />　var len = ua.indexOf(";", offset);<br />　var version = parseFloat(ua.substring(offset+5, len));<br />　if(version &gt;= 5){<br />　　/* ver5以上の場合 */<br />　} else if(version &gt;= 4){<br />　　/* ver4の場合 */<br />　} else {<br />　　/*ver4未満の場合*/<br />　}<br />} else {<br />/*それ以外のブラウザ*/<br />}</pre><br />昔、できる限りの条件文岐を行い，ブラウザごとに目的を達成することが，ある意味，Coolだった。<br /><br />W3C DOMでは『DOMとは，プログラムやスクリプトからダイナミックに，文書の内容・構造・スタイルにアクセスでき，そしてそれをアップデートできる，プラットフォームや言語に依存しないインタフェースである。』<br />JAVA，PHP，Perlでもサポートしている。<br /><br />Internet ExplorerはDOMの準拠が遅れている<br /><br /><pre>&lt;DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EM"&gt;<br />&lt;html&gt;<br />&lt;head&gt;<br />&lt;meta http-equiv="Content-Language" content="ja"&gt;<br />&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;<br />&lt;title&gt;ドキュメントツリー&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />&lt;h1&gt;ドキュメントツリー&lt;/h1&gt;<br />&lt;p&gt;HTMLの要素の構造を表します。&lt;/p&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</pre><br />ノード<br /><ul><li>要素ノード</li><li>テキストノード</li><li>ホワイトスペースノード（スペースや改行）IEは出ない</li></ul><br />Firefox：DOM Inspector (add-on)<br />Opera：Opera Developer Console<br />等で確認する。<br /><br />DOMを使ってHTMLの特定の要素を参照するための三つのメソッド<br /><ul><li>document.getElementById('id属性値');</li><li>document.getElementsByTagName('要素【タグ】名');</li><li>document.getElementsByName('name属性値');</li></ul><br /><pre>サンプルHTML<br />&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;<br />&lt;html&gt;<br />&lt;head&gt;<br />&lt;meta http-equiv="Content-language" content="ja"&gt;<br />&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;<br />&lt;title&gt;W3C Document Object Model&lt;/title&gt;<br />&lt;/head&gt;<br /><br />&lt;body&gt;<br /><br />&lt;a name="level1"&gt;&lt;/a&gt;<br />&lt;h2&gt;Document Object Model Level 1&lt;/h2&gt;<br />&lt;a href="http://www.w3.org/TR/REC-DOM-Level-1/level-one-core.html"<br />id="dom1_core"&gt;Core&lt;/a&gt;<br />&lt;a href="http://www.w3.org/TR/REC-DOM-Level-1/level-one-html.html"<br />id="dom1_html"&gt;HTML&lt;/a&gt;<br /><br />&lt;a name="level2"&gt;&lt;/a&gt;<br />&lt;h2&gt;Document Object Model Level 2&lt;/h2&gt;<br />&lt;a href="http://www.w3.org/TR/DOM-Level-2-Core/"<br />id="dom2_core"&gt;Core&lt;/a&gt;<br />&lt;a href="http://www.w3.org/TR/TR/DOM-Level-2-HTML/"<br />id="dom2_html"&gt;HTML&lt;/a&gt;<br />&lt;a href="http://www.w3.org/TR/TR/DOM-Level-2-Events/"<br />id="dom2_events"&gt;Events&lt;/a&gt;<br /><br />&lt;/body&gt;<br /><br />&lt;/html&gt;</pre><br /><br /><h5>getElementByIdメソッド</h5>引数にid属性値を指定することで，一発で特定の要素を抜き出す。<br /><br />id属性値に"dom2_html"がセットされた要素を参照<br /><pre>&lt;script type="text/javascript"&gt;<br />var elm = document.getElementById('dom2_html');<br />alert(elem.href);<br />&lt;/script&gt;</pre><br /><br /><h5>getElementsByTagNameメソッド</h5>id属性値がセットされていない要素を参照したい場合<br />要素名を指定することで，指定された要素名の要素をすべて取り出す。<br /><br />id属性値に"dom2_html"がセットされた要素を参照<br /><pre>&lt;script type="text/javascript"&gt;<br />var list = document.getElementsByTagName('A');<br />var elm = list.item(5);<br />alert(elm.href);<br />&lt;/script&gt;</pre><br />getElementsByTagNameメソッドはリストが返ってくる<br />しかしJavaScriptの配列とは異なりNodeListと呼ばれる<br />itemメソッド：引数にインデックス番号を指定することで該当の要素を返す<br />lengthプロパティ：NodeListに格納されている要素の数を返します。<br /><br /><h5>getElementsByNameメソッド</h5>name属性値から要素を参照する<br />NodeListとして返す<br /><br />name属性値に"level2"がセットされた要素を参照<br /><pre>&lt;script type="text/javascript"&gt;<br />var list = document.getElementByName('level2');<br />var elm = list.item(0);<br />alert(elem.name);<br />&lt;/script&gt;</pre><br />メソッドを組み合わせて使う<br /><pre>サンプルHTML<br />&lt;ul id="levels"&gt;<br />&lt;li title="level1"&gt;Level 1&lt;/li&gt;<br />&lt;li title="level2"&gt;Level 2&lt;/li&gt;<br />&lt;li title="level3"&gt;Level 3&lt;/li&gt;<br />&lt;/ul&gt;</pre><br /><pre>var ul = document.getElementById('levels');<br />var elm = ul.getElemenstByTagName('LI').item(1);<br />alert(elem.title);</pre><br />まず、getElementByIdメソッドで範囲を絞り込みgetElementsByTagNameメソッドを使用する。getElementsByNameメソッドは，documentオブジェクトに対してしか適用できない。<br /><br /><h5>子要素・親要素を参照する</h5><ul><li>childNodesプロパティ：子要素のリストをNodeListで返す。</li><li>firstChildプロパティ：最初の子要素を返す。</li><li>lastChildプロパティ：最後の子要素を返す。</li><li>parentNodeプロパティ：親要素を返す</li></ul><br /><pre>var ul = document.getElementById('levels');<br />/* UL要素の子要素のリスト */<br />var children = ul.childNodes;<br /><br />/* 子要素の数をアラート */<br />/* IEは3、それ以外は7 */<br />alert(children.length);<br /><br />/* 最初の子要素のtitile属性値をレポート */<br />/* IEはlevel1、それ以外はundefined */<br />alert(ul.firstChild.title);<br /><br />/* 最後の子要素のtitile属性値をレポート */<br />/* IEはlevel3、それ以外はundefined */<br />alert(ul.lastChild.title);</pre><br />firefoxなどは改行やホワイトスペースもテキストノードとしてカウントされるため<br /><br /><h5>回避方法</h5>子要素を特定する際に，childNodes/firstChild/lastChildプロパティを使わず，getElementsByTagNameメソッドを使って，必要な要素だけを取り出すようにする。<br />childNodes/firstChild/lastChildプロパティを使って取り出した要素の種類を判別するロジックを加える。<br /><br /><h5>子要素の存在をチェック</h5>子要素が存在するかどうかをチェック<br />childNodesプロパティから得られるNodeListのlengthプロパティを使う。<br /><br /><pre>var ul = document.getElementById('levels');<br />if(ul.childNodes.length &gt; 0) {<br />/*子要素が存在した場合の処理*/<br />}<br />hasChildNodesメソッドを使う。<br />if(ul.hasChildnodes()){<br />/*子要素が存在した場合の処理*/<br />}</pre><br /><pre>サンプルHTML<br />&lt;DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;<br />&lt;html&gt;<br />&lt;head&gt;<br />&lt;meta http-equiv="Content-Language" content="ja"&gt;<br />&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;<br />&lt;title&gt;W3C Document Object Model&lt;/title&gt;<br />&lt;/head&gt;<br />&lt;body&gt;<br />&lt;!-- これはサンプルです --&gt;<br />&lt;h2 original="独自の属性"&gt;Document Object Model level 1&lt;/h2&gt;<br />&lt;a href="#" id="dom1_core" class="dom1"&gt;Core&lt;/a&gt; |<br />&lt;a href="#" id="dom1_html" class="dom1"&gt;HTML&lt;/a&gt; | &lt;/body&gt;&lt;/html&gt;</pre><h5>nodeNameプロパティ</h5>nodeNameプロパティから得られるタグ名はすべて大文字に変換される<br /><pre>var h2 = document.getElementsByTagName("H2").item(0);<br />alert(h2.nodeName); /* H2 */</pre><br /><h5>nodeValueプロパティ</h5>テキストを参照するためには該当の要素の子要素を参照。<br /><pre>var h2 = document.getElementsByTagName("H2").item(0);<br />var text = h2.firstChild.nodeValue;<br />alert(text); /* Document Object Model level 1 */</pre><br /><h5>nodeTypeプロパティ</h5>ノードのタイプを判定する<br /><pre>&lt;script type="text/javascript"&gt;<br />onload = function() {<br />var nodes = document.body.childNodes;<br />var len = nodes.length;<br />var msg = ";<br />for(var i=0; i &lt; len; i++){<br />var node = nodes.item(i);<br />msg +=node.nodeName + "\t";<br />msg +=node.nodeType + "\t";<br />msg +=node.nodeValue + "\n";<br />}<br />alert(msg);<br />}</pre><br /><h5>getAttributeメソッド</h5>引数に属性名を指定すると，その属性値を返す<br /><pre>alert( document.getElementById('dom1_core').href );<br />alert( document.getElementById('dom1_core').getAttribute('href') );</pre>同じ結果。<br /><br /><h5>class属性</h5>classではなくclassName<br />プロパティを使ったほうが無難か。<br /><pre>alert( document.getElementById('dom1_core').className );<br />alert( document.getElementById('dom1_core').getAttribute('class') );</pre><br /><h5>独自属性の場合</h5><pre>var h2 = document.getElementsByTagName('H2').item(0);<br />alert(h2.original); /* IE以外ではundefined */<br />alert(h2.getAttribute)('original'));</pre>HTMLでは規定されていない属性値を取り出したい場合は，必ずgetAttributeメソッドを使う<br /><br /><h5>setAttributeメソッド</h5>属性の値をセットする<br /><pre>document.getElementById("dom1_core").href = "http://w3c.org";<br />document.getElementById("dom1_core").setAttribute('href' , 'http://w3c.org');</pre><br /><h5>createElementメソッド</h5>引数に要素名を与えることで指定の要素が作られその要素ノードオブジェクトが返される<br /><pre>var img = document.createElement('img');<br />img.src = "sample.png";<br /><br />&lt;img src="sample.pmg"&gt;を生成</pre><br /><h5>appendChildメソッド</h5>生成した要素ノードオブジェクトを引数に与えるとそれを画面上に表示<br />document.body.appendChild(img);<br /><br /><h5>createTextNodeメソッド</h5>引数にテキストを与えるとそのテキストノードオブジェクトを返す<br /><br />ex. A要素をBODY要素に追加<br /><pre>/* A要素を新たに生成 */<br />var anchor = document.createElement("a");<br /><br />/* A要素にhref属性をセット */<br />anchor.href = "http://w3c.org/"<br /><br />/* テキストノードを新たに生成 */<br />var text = document.createTextNode("W3C");<br /><br />/* テキストノードをＡ要素の子要素として追加 */<br />anchor.appendChild(text);<br /><br />/* 画面表示 */<br />document.body.appendChild(anchor);</pre><br /><h5>removeChildメソッド</h5><pre>&lt;div id="box"&gt;&lt;img src="sample.png" id="pic"&gt;&lt;/div&gt;<br /><br />/* DIV要素のノードオブジェクト */<br />var box = document.getElementById("box");<br /><br />/* IMG要素のノードオブジェクト */<br />var pic = document.getElementById("pic");<br /><br />/* IMG要素を削除 */<br />box.removeChild(pic);</pre><br />いちいち親要素をノードオブジェクトを用意するのは面倒なのでparentNodeプロパティを使って親要素を参照<br /><br /><br /><pre>/* IMG要素のノードオブジェクト */<br />var pic = document.getElementById("pic");<br /><br />/* IMG要素を削除 */<br />pic.parentNode.removeChild(pic);</pre><h5>ケーススタディ</h5><pre>&lt;form action="#" method="post" id="agreeform"&gt;<br />&lt;input type="checkbox" name="agree" value="1" id="agree"&gt;<br />同意する。<br />&lt;/form&gt;</pre><br /><pre>window.onload = function() {<br />/* チェックボックス */<br />var agree = document.getElementById("agree");<br />/* フォーム */<br />var agreeform = document.getElementById("agreeform");<br />/* チェックボックスにonclickイベントハンドラをセット */<br />agree.onclick = function() {<br />if(agree.checked == true) {<br />/* チェックが入った時はボタンを生成表示 */<br />var btn = document.createElement("input");<br />btn.type = "submit";<br />btn.value = "次へ";<br />btn.id = "btn";<br />agreeform.appendChild("btn");<br />} else {<br />/* チェックがはずされた時はボタンを削除 */<br />var btn = document.getElementById("btn");<br />if(btn) {<br />btn.parentNode.removeChild(btn);<br />}<br />}<br />};<br />};</pre>
